<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Gold and Rabbit&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="having fun coding">
<meta property="og:type" content="website">
<meta property="og:title" content="Gold and Rabbit&#39;s Blog">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Gold and Rabbit&#39;s Blog">
<meta property="og:description" content="having fun coding">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Gold and Rabbit">
<meta property="article:tag" content="Recommending System">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Gold and Rabbit&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 5.1.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Gold and Rabbit&#39;s Blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-Item-Based CF" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/09/14/Item-Based%20CF/" class="article-date">
  <time datetime="2020-09-14T14:56:00.000Z" itemprop="datePublished">2020-09-14</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Recsys-Ads-Tech/">Recsys & Ads Tech</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/09/14/Item-Based%20CF/">Item-Based CF</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
      	<!-- Table of Contents -->
		
        <h2 id="Graph-Distance-Metrics"><a href="#Graph-Distance-Metrics" class="headerlink" title="Graph Distance Metrics"></a>Graph Distance Metrics</h2><ul>
<li>度量距离的方式<div style="text-align: center;">
<img alt="" src="https://i.loli.net/2020/09/14/C2k7zgqBLOYeH9a.png" style="display: inline-block;"/>
</div>



</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/09/14/Item-Based%20CF/" data-id="ckfahcyd80006l0dlex979wbe" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Why Alibaba 为什么历史选择了阿里巴巴" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/06/05/Why%20Alibaba%20%E4%B8%BA%E4%BB%80%E4%B9%88%E5%8E%86%E5%8F%B2%E9%80%89%E6%8B%A9%E4%BA%86%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4/" class="article-date">
  <time datetime="2020-06-05T14:56:00.000Z" itemprop="datePublished">2020-06-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E8%A1%8C%E4%B8%9A%E6%80%9D%E8%80%83/">行业思考</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/06/05/Why%20Alibaba%20%E4%B8%BA%E4%BB%80%E4%B9%88%E5%8E%86%E5%8F%B2%E9%80%89%E6%8B%A9%E4%BA%86%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4/">Why Alibaba 为什么历史选择了阿里巴巴</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
      	<!-- Table of Contents -->
		
        <h2 id="发展驱动力：因实际问题需解决"><a href="#发展驱动力：因实际问题需解决" class="headerlink" title="发展驱动力：因实际问题需解决"></a>发展驱动力：因实际问题需解决</h2><h5 id="C端商家和用户之间交易安全-amp-信任的问题。"><a href="#C端商家和用户之间交易安全-amp-信任的问题。" class="headerlink" title="C端商家和用户之间交易安全&amp;信任的问题。"></a>C端商家和用户之间交易安全&amp;信任的问题。</h5><p>淘宝初期发展时期，需要解决C端商家和用户之间交易安全&amp;信任的问题。卖家先发货还是买家先付款？如果双方有一方抵赖怎么办？双方都是陌生人互不相识如何建立信任？如果解决不了同时让卖家、买家同时放心的交易的问题，电商平台一定是做不起来的。当时阿里巴巴是希望第三方（银行）去完成这件事情，但是由于交易复杂性（例如，一笔交易可能就是几块钱几毛钱，相比银行的主营业务，银行最少的服务费都比这个来的多）银行不愿意完成这件事情，逼不得已使得阿里在支付技术上进行大规模推进。<br>淘宝客服系统: 购物时带来一种安全感；想买一台PC，但是这个PC不是一件预算较低商品，无论详情页写的多么具体，购物体验远远低于真人客服；</p>
<h5 id="技术面临大促期间的流量洪峰问题。"><a href="#技术面临大促期间的流量洪峰问题。" class="headerlink" title="技术面临大促期间的流量洪峰问题。"></a>技术面临大促期间的流量洪峰问题。</h5><p>在面对双11大促流量洪峰，双11当天客户不能流畅的进行交易，对客户而言不流畅的购物体验会对平台造成非常致命的影响（类比大学选课系统，找到自己心仪课程之后一旦点击就会卡死，等到网络恢复正常发现课程已经被选满；类比早期12306在过年期间抢不到票，大量乘客面临“过年回不了家”这种问题），如果C端客户在大促期间体验非常差也会让B端卖家失去对于平台的信任。为解决这个问题，催生云计算（海量数据处理技术、数据库底层技术）业务的发展。</p>
<h5 id="双11的包裹堆积配送效率低下的问题。"><a href="#双11的包裹堆积配送效率低下的问题。" class="headerlink" title="双11的包裹堆积配送效率低下的问题。"></a>双11的包裹堆积配送效率低下的问题。</h5><p>大一大二时，双十一期间快递爆仓。各种排队。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/06/05/Why%20Alibaba%20%E4%B8%BA%E4%BB%80%E4%B9%88%E5%8E%86%E5%8F%B2%E9%80%89%E6%8B%A9%E4%BA%86%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4/" data-id="ckfahcydb0009l0dle0anhfrx" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Git使用" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/04/05/Git%E4%BD%BF%E7%94%A8/" class="article-date">
  <time datetime="2020-04-05T14:56:00.000Z" itemprop="datePublished">2020-04-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Programming-Data/">Programming & Data</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/04/05/Git%E4%BD%BF%E7%94%A8/">Git使用</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
      	<!-- Table of Contents -->
		
        <p>执行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -C &quot;你自己的github对应的邮箱地址&quot;</span><br></pre></td></tr></table></figure>
<p>一路回车</p>
<p>（通过ls查看～/.ssh下面的所有内容查看）</p>
<p>将刚刚创建的ssh keys添加到github中<br>（1）利用gedit/cat命令，查看id_rsa.pub的内容<br>（2）在GitHub中，依次点击Settings -&gt; SSH Keys -&gt; Add SSH Key，将id_rsa.pub文件中的字符串复制进去，注意字符串中没有换行和空格。</p>
<p>再次检查SSH连接情况（在～/.ssh目录下）：<br>输入如下命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -T git@github.com</span><br></pre></td></tr></table></figure>

<p>如果看到如下所示，则表示添加成功：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hi 你的用户名! You’ve successfully authenticated, but GitHub does not provide shell access.</span><br></pre></td></tr></table></figure>

<p>即利用自己的用户名和email地址配置git</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name &quot;你的github用户名&quot;</span><br><span class="line">git config --global user.email &quot;你的github邮箱地址&quot;</span><br></pre></td></tr></table></figure>

<p>为什么配置好了提交代码到远程分之还是要输入密码?<br>clone的时候选择http</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/04/05/Git%E4%BD%BF%E7%94%A8/" data-id="ckfahcyd70005l0dl3x4h8ek6" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Faiss" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/04/04/Faiss/" class="article-date">
  <time datetime="2020-04-04T12:11:00.000Z" itemprop="datePublished">2020-04-04</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Programming-Data/">Programming & Data</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/04/04/Faiss/">Faiss</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
      	<!-- Table of Contents -->
		
        <h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><ul>
<li>A library for efficient similarity search and clustering of dense vectors.Faiss：高效稠密向量相似Top检索库;</li>
<li>Faiss contains several methods for similarity search. It assumes that the instances are represented as vectors and are identified by an integer, and that the vectors can be compared with L2 (Euclidean) distances or dot products. Vectors that are similar to a query vector are those that have the lowest L2 distance or the highest dot product with the query vector. It also supports cosine similarity, since this is a dot product on normalized vectors. Faiss支持多种相似度检索度量：L2距离，点积和余弦相似度。</li>
</ul>
<h2 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 更新conda</span></span><br><span class="line">conda update conda</span><br><span class="line"><span class="meta">#</span><span class="bash"> 先安装mkl</span></span><br><span class="line">conda install mkl</span><br><span class="line"><span class="meta">#</span><span class="bash"> gpu版本 -- 记得根据自己安装的cuda版本安装对应的faiss版本，不然会出异常</span></span><br><span class="line">conda install faiss-gpu cudatoolkit=10.0 -c pytorch # For CUDA10</span><br></pre></td></tr></table></figure>

<h2 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> faiss</span><br><span class="line">d = <span class="number">64</span>                           <span class="comment"># dimension</span></span><br><span class="line">nb = <span class="number">100000</span>                      <span class="comment"># database size</span></span><br><span class="line">nq = <span class="number">10000</span>                       <span class="comment"># nb of queries</span></span><br><span class="line">np.random.seed(<span class="number">1234</span>)             <span class="comment"># make reproducible</span></span><br><span class="line">xb = np.random.random((nb, d)).astype(<span class="string">&#x27;float32&#x27;</span>)</span><br><span class="line">xq = np.random.random((nq, d)).astype(<span class="string">&#x27;float32&#x27;</span>)</span><br><span class="line">xb[:, <span class="number">0</span>] += np.arange(nb) / <span class="number">1000.</span></span><br><span class="line">xq[:, <span class="number">0</span>] += np.arange(nq) / <span class="number">1000.</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Faiss is built around the Index object.</span></span><br><span class="line"><span class="string">It encapsulates the set of database vectors, and optionally preprocesses them to make searching efficient.</span></span><br><span class="line"><span class="string">There are many types of indexes,</span></span><br><span class="line"><span class="string">we are going to use the simplest version that just performs brute-force L2 distance search on them: IndexFlatL2.</span></span><br><span class="line"><span class="string">All indexes need to know when they are built which is the dimensionality of the vectors they operate on, d in our case.</span></span><br><span class="line"><span class="string">Then, most of the indexes also require a training phase, to analyze the distribution of the vectors. For IndexFlatL2, we can skip this operation.</span></span><br><span class="line"><span class="string">When the index is built and trained, two operations can be performed on the index: add and search.</span></span><br><span class="line"><span class="string">To add elements to the index, we call add on xb.</span></span><br><span class="line"><span class="string">We can also display the two state variables of the index: is_trained, a boolean that indicates whether training is required and ntotal, the number of indexed vectors.</span></span><br><span class="line"><span class="string">Some indexes can also store integer IDs corresponding to each of the vectors (but not IndexFlatL2).</span></span><br><span class="line"><span class="string">If no IDs are provided, add just uses the vector ordinal as the id, ie. the first vector gets 0, the second 1, etc.</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">index = faiss.IndexFlatL2(d)     <span class="comment"># build the index</span></span><br><span class="line">print(index.is_trained)          <span class="comment"># log: True</span></span><br><span class="line">index.add(xb)                    <span class="comment"># add vectors to the index</span></span><br><span class="line">print(index.ntotal)              <span class="comment"># log: 100000</span></span><br><span class="line">​</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">The basic search operation that can be performed on an index is the k-nearest-neighbor search,</span></span><br><span class="line"><span class="string">ie. for each query vector, find its k nearest neighbors in the database.</span></span><br><span class="line"><span class="string">The result of this operation can be conveniently stored in an integer matrix of size nq-by-k,</span></span><br><span class="line"><span class="string">where row i contains the IDs of the neighbors of query vector i, sorted by increasing distance.</span></span><br><span class="line"><span class="string">In addition to this matrix, the search operation returns a nq-by-k floating-point matrix with the corresponding squared distances.</span></span><br><span class="line"><span class="string">As a sanity check, we can first search a few database vectors, to make sure the nearest neighbor is indeed the vector itself.</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">k = <span class="number">4</span>                          <span class="comment"># we want to see 4 nearest neighbors</span></span><br><span class="line">D, I = index.search(xb[:<span class="number">5</span>], k) <span class="comment"># sanity check</span></span><br><span class="line">print(I)</span><br><span class="line">print(D)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">[[  0 393 363  78]</span></span><br><span class="line"><span class="string"> [  1 555 277 364]</span></span><br><span class="line"><span class="string"> [  2 304 101  13]</span></span><br><span class="line"><span class="string"> [  3 173  18 182]</span></span><br><span class="line"><span class="string"> [  4 288 370 531]]</span></span><br><span class="line"><span class="string">[[0.        7.1751738 7.20763   7.2511625]</span></span><br><span class="line"><span class="string"> [0.        6.3235645 6.684581  6.799946 ]</span></span><br><span class="line"><span class="string"> [0.        5.7964087 6.391736  7.2815123]</span></span><br><span class="line"><span class="string"> [0.        7.2779055 7.527987  7.6628466]</span></span><br><span class="line"><span class="string"> [0.        6.7638035 7.2951202 7.3688145]]</span></span><br><span class="line"><span class="string">the nearest neighbor of each query is indeed the index of the vector,</span></span><br><span class="line"><span class="string">and the corresponding distance is 0. And within a row, distances are increasing.</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">D, I = index.search(xq, k)     <span class="comment"># actual search</span></span><br><span class="line">print(I[:<span class="number">5</span>])                   <span class="comment"># neighbors of the 5 first queries</span></span><br><span class="line">print(I[<span class="number">-5</span>:])                  <span class="comment"># neighbors of the 5 last queries</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">[[ 381  207  210  477]</span></span><br><span class="line"><span class="string"> [ 526  911  142   72]</span></span><br><span class="line"><span class="string"> [ 838  527 1290  425]</span></span><br><span class="line"><span class="string"> [ 196  184  164  359]</span></span><br><span class="line"><span class="string"> [ 526  377  120  425]]</span></span><br><span class="line"><span class="string">[[ 9900 10500  9309  9831]</span></span><br><span class="line"><span class="string"> [11055 10895 10812 11321]</span></span><br><span class="line"><span class="string"> [11353 11103 10164  9787]</span></span><br><span class="line"><span class="string"> [10571 10664 10632  9638]</span></span><br><span class="line"><span class="string"> [ 9628  9554 10036  9582]]</span></span><br><span class="line"><span class="string">Because of the value added to the first component of the vectors,</span></span><br><span class="line"><span class="string">the dataset is smeared along the first axis in d-dim space. </span></span><br><span class="line"><span class="string">So the neighbors of the first few vectors are around the beginning of the dataset,</span></span><br><span class="line"><span class="string">and the ones of the vectors around ~10000 are also around index 10000 in the dataset.</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">To speed up the search, it is possible to segment the dataset into pieces.</span></span><br><span class="line"><span class="string">We define Voronoi cells in the d-dimensional space, and each database vector falls in one of the cells.</span></span><br><span class="line"><span class="string">At search time, only the database vectors y contained in the cell the query x falls in and a few neighboring ones are compared against the query vector.</span></span><br><span class="line"><span class="string">This is done via the IndexIVFFlat index.</span></span><br><span class="line"><span class="string">This type of index requires a training stage, that can be performed on any collection of vectors that has the same distribution as the database vectors.</span></span><br><span class="line"><span class="string">In this case we just use the database vectors themselves.</span></span><br><span class="line"><span class="string">The IndexIVFFlat also requires another index, the quantizer, that assigns vectors to Voronoi cells.</span></span><br><span class="line"><span class="string">Each cell is defined by a centroid, and finding the Voronoi cell a vector falls in consists in finding the nearest neighbor of the vector in the set of centroids.</span></span><br><span class="line"><span class="string">This is the task of the other index, which is typically an IndexFlatL2.</span></span><br><span class="line"><span class="string">There are two parameters to the search method: nlist, the number of cells, and nprobe, the number of cells (out of nlist) that are visited to perform a search.</span></span><br><span class="line"><span class="string">The search time roughly increases linearly with the number of probes plus some constant due to the quantization.</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">nlist = <span class="number">100</span>                       <span class="comment"># 聚类中心个数</span></span><br><span class="line">k = <span class="number">4</span></span><br><span class="line">quantizer = faiss.IndexFlatL2(d)  <span class="comment"># the other index</span></span><br><span class="line">index = faiss.IndexIVFFlat(quantizer, d, nlist)</span><br><span class="line"><span class="keyword">assert</span> <span class="keyword">not</span> index.is_trained</span><br><span class="line">index.train(xb)</span><br><span class="line"><span class="keyword">assert</span> index.is_trained</span><br><span class="line"></span><br><span class="line">index.add(xb)                  <span class="comment"># add may be a bit slower as well</span></span><br><span class="line">D, I = index.search(xq, k)     <span class="comment"># actual search</span></span><br><span class="line">print(I[<span class="number">-5</span>:])                  <span class="comment"># neighbors of the 5 last queries</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">[[ 9900  9309  9810 10048]</span></span><br><span class="line"><span class="string"> [11055 10895 10812 11321]</span></span><br><span class="line"><span class="string"> [11353 10164  9787 10719]</span></span><br><span class="line"><span class="string"> [10571 10664 10632 10203]</span></span><br><span class="line"><span class="string"> [ 9628  9554  9582 10304]]</span></span><br><span class="line"><span class="string">The values are similar, but not exactly the same as for the brute-force search (see above).</span></span><br><span class="line"><span class="string">This is because some of the results were not in the exact same Voronoi cell.</span></span><br><span class="line"><span class="string">Therefore, visiting a few more cells may prove useful. &#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">index.nprobe = <span class="number">10</span>              <span class="comment"># default nprobe is 1, try a few more 默认聚类中心个数1, 尝试调大中心数10</span></span><br><span class="line">D, I = index.search(xq, k)</span><br><span class="line">print(I[<span class="number">-5</span>:])                  <span class="comment"># neighbors of the 5 last queries</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">[[ 9900 10500  9309  9831]</span></span><br><span class="line"><span class="string"> [11055 10895 10812 11321]</span></span><br><span class="line"><span class="string"> [11353 11103 10164  9787]</span></span><br><span class="line"><span class="string"> [10571 10664 10632  9638]</span></span><br><span class="line"><span class="string"> [ 9628  9554 10036  9582]]</span></span><br><span class="line"><span class="string">which is the correct result.</span></span><br><span class="line"><span class="string">Note that getting a perfect result in this case is merely an artifact of the data distribution,</span></span><br><span class="line"><span class="string">as it is has a strong component on the x-axis which makes it easier to handle.</span></span><br><span class="line"><span class="string">The nprobe parameter is always a way of adjusting the tradeoff between speed and accuracy of the result.</span></span><br><span class="line"><span class="string">Setting nprobe = nlist gives the same result as the brute-force search (but slower).</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">ngpus = faiss.get_num_gpus()</span><br><span class="line">print(<span class="string">&#x27;number of GPUS:&#x27;</span>, ngpus)</span><br><span class="line">res = faiss.StandardGpuResources()</span><br><span class="line"><span class="comment"># build a flat (CPU) index</span></span><br><span class="line">index_flat = faiss.IndexFlatL2(d)</span><br><span class="line"><span class="comment"># make it into a gpu index</span></span><br><span class="line">gpu_index_flat = faiss.index_cpu_to_gpu(res, <span class="number">0</span>, index_flat)</span><br><span class="line">gpu_index_flat.add(xb)</span><br><span class="line">print(gpu_index_flat.ntotal)</span><br><span class="line">D, I = gpu_index_flat.search(xq, k)     <span class="comment"># actual search</span></span><br><span class="line">print(I[:<span class="number">5</span>])                            <span class="comment"># neighbors of the 5 first queries</span></span><br><span class="line">print(I[<span class="number">-5</span>:])                           <span class="comment"># neighbors of the 5 last queries</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># add self defined index</span></span><br><span class="line">index = faiss.IndexFlatL2(xb.shape[<span class="number">1</span>])</span><br><span class="line">ids = np.arange(xb.shape[<span class="number">0</span>]) + <span class="number">231</span></span><br><span class="line">index2 = faiss.IndexIDMap(index)</span><br><span class="line">index2.add_with_ids(xb, ids)</span><br><span class="line">k = <span class="number">4</span>                                   <span class="comment"># we want to see 4 nearest neighbors</span></span><br><span class="line">D, I = index2.search(xq, k)             <span class="comment"># actual search</span></span><br><span class="line">print(I[:<span class="number">5</span>])                            <span class="comment"># neighbors of the 5 first queries</span></span><br><span class="line">print(I[<span class="number">-5</span>:])                           <span class="comment"># neighbors of the 5 last queries</span></span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/04/04/Faiss/" data-id="ckfahcyd60004l0dl8mde7s00" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-狼人杀如何致胜" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/03/22/%E7%8B%BC%E4%BA%BA%E6%9D%80%E5%A6%82%E4%BD%95%E8%87%B4%E8%83%9C/" class="article-date">
  <time datetime="2020-03-21T18:12:57.000Z" itemprop="datePublished">2020-03-22</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E7%BB%8F%E9%AA%8C%E6%80%BB%E7%BB%93/">经验总结</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/03/22/%E7%8B%BC%E4%BA%BA%E6%9D%80%E5%A6%82%E4%BD%95%E8%87%B4%E8%83%9C/">狼人杀如何致胜</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
      	<!-- Table of Contents -->
		
        <h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><ul>
<li>到底是一个重点是靠盘逻辑的游戏？还是一个缺少逻辑、更多的是表演/发言/说谎的游戏？逻辑在获胜上占到多少比重？</li>
<li>表演是这个游戏里面重要的部分。如何正确的从自己的角色表演，达到获胜的目的。</li>
<li>作为游戏，均存在玩物丧志属性，总结游戏玩法也是符合让这个游戏对于我的边际效益最小化的目的，鼓励投入到新领域中去。</li>
<li>本文重点是9人国标局。3民3狼1预1巫1猎。12人局存在玩家质量参差不齐的局面。</li>
</ul>
<h2 id="获胜之道"><a href="#获胜之道" class="headerlink" title="获胜之道"></a>获胜之道</h2><ul>
<li>总结一下玩到现在如何获得胜利的方法，理论不一定严谨，整体目的是避免一些错误的发言和节奏，梳理一些关键性的要点，在整体上最大化胜率。重点解析预言家和狼人这两个角色。</li>
</ul>
<h5 id="预言家"><a href="#预言家" class="headerlink" title="预言家"></a>预言家</h5><ul>
<li>预言家是9人局胜率最低的角色，这是由于规则决定的（大概率双神起跳）。</li>
<li>作为预言家必须非常坦然接受你死的很快或者你死的很冤的事实。</li>
<li>发言的时候必须快速清晰的报出来查验，以免还没有说出来任何查验只透露自己身份然后被狼人自爆。预言家在遗言的时候。一定要多说。即使是非常冤死。但是真预言家的求生欲一定不能过低。</li>
</ul>
<h5 id="狼人"><a href="#狼人" class="headerlink" title="狼人"></a>狼人</h5><ul>
<li>狼人的胜利关键在于“顺势而为”，三只狼人需要各自独立地根据场上的形势因时制宜的选择悍跳/划水/引导/站边/跟票/冲票。</li>
<li>同时三狼要有一定程度的分工，整体态势太趋同（都怂或者都悍跳）风险的。</li>
</ul>
<h2 id="案例复盘"><a href="#案例复盘" class="headerlink" title="案例复盘"></a>案例复盘</h2><h4 id="失败的一局复盘"><a href="#失败的一局复盘" class="headerlink" title="失败的一局复盘"></a>失败的一局复盘</h4><div style="text-align: center;">
<img alt="" src="https://i.loli.net/2020/09/14/QYTr83RcIsd4qWh.jpg" style="display: inline-block;" width="200"/>
</div>


<ul>
<li>图上这局是我玩的比较失败的一局。结果：作为好人阵营（猎人）我们输的非常彻底，被一只悍跳狼完全带了节奏，狼人预言家身份坐实，民整体没有视角做得出的选择也都是错误的，神职女巫和猎人完全齐齐的走向了错误的做法。</li>
</ul>
<p>这局的特殊在于 </p>
<ol>
<li>一局下来好人之间几乎没有形成提供有效的通讯（统计来看9人国标局好人输概率大于50%，但是好人们几乎完全没有相互之间的信息认可，这种是绝对不算多的案例）。</li>
<li>悍跳狼第一天就被投死，其余怂狼从头到尾也没有也没有太多行动。但是好人掉进圈套里完全出不来，后续决策是一连串错误，而且是走向那种温水煮青蛙的错误节奏。</li>
<li>整局游戏来看，好人绝对不是一定输，是肯定机会逆转的，但是整体上我认为好人如果想赢非常艰难，故做一下复盘。</li>
</ol>
<h4 id="重点历程"><a href="#重点历程" class="headerlink" title="重点历程"></a>重点历程</h4><ol start="0">
<li><p>狼人刀3号女巫，3女巫自救。9预言家8金水。</p>
</li>
<li><p>第一天9号第一个发言，说自己预言家给8号的民发了金水，发言过程中没有明显语气或者逻辑上的问题。然后说由于7、8、9位置学，轻踩一下7号。接着顺次12345发言均没有有效信息，其中女巫跳出来身份说明是自救的。<br>8号是归票位，给8发出去金水，然后8又没有身份，我当时认为信服力不一定。<br>但是8不是神职，如果9是狼人发到8民身上，可能性也是存在的，发言上没有明显问题，当时我没有完全不信或者不信。</p>
</li>
<li><p>然后6号发言，给7号发了查杀。<br>从位置上来看，9预言家8号金水则7号位置有些尴尬。<br>6给7查杀，当时我是不太信的，然后7号是民，但7的角度而言，6和9对7都有一定攻击性。但6是查杀，他从自身身份出发只能从发言打死6。</p>
</li>
<li><p>第一天投票：我上票给了7号，6整体发言语气和逻辑都还好（6查验的是后位置的7有合理性，感觉9的力度不太好说，其实我这里操作有一定的赌博性，我是猎人从容错的角度出发可以这么投）。但是结果4，7，8，9投6，结果6出局。<br>这里狼人有个破绽，2和5选择了弃票。但当时在69发言都没有明显破绽的情况下，我对这个弃票没有太怀疑，思考的重点还是6/9谁是真预言家上。</p>
</li>
<li><p>6号发表遗言：<br>6发言整体比较激动，语气没问题像真预言家，用了4张加时卡，逻辑上看整体发言就表达一个他的逻辑：9预8金，则7是位置及其尴尬的一张牌。如果6是一只狼人，为什么不隐藏自己的身份，大概率把7打出去呢。为什么一定要站出来把7打死，铁铁的要打死这张7呢。<br>这里无非两种情况（当时我没有把这两种情况盘的非常清楚）：</p>
<ol>
<li>6是真预言家，验出来7是狼人，然后从到尾踩死这个7。 </li>
<li>6是狼人，这个狼人选择很冒险却收益很小的一步，冒着自己被投出去的风险杀死7这个民。他的风险在于大家可能不信他是真预言家（事实上第一轮投票大家真没相信）。因为9首位发言给归票位金水预言家面还是有一些的。<br>然后这里1我、3巫、还有4民这三个人无一例外心路历程都是上述第1种，相信了6是真预言家。当时怎么看觉得呢这个6非要踩死这个7，从他的狼人视角来看真的收益好小。</li>
</ol>
</li>
<li><p>第二天晚上9真预查验的是1猎（就是我）是好人，女巫因为是认定6真预言家，所以必然是要开毒，选择毒7。狼人杀了3女巫。<br>然后第二天我是最后发言的归票位。然后第二天白天发言2号没什么信息，3女巫被杀，4民5狼发言如下：<br>4民说了自己觉得信了6真预言家，理由就是感觉上一局6狼的话收益太小。且现在9还活着。表示想上票给9。<br>5狼发言表示和4的逻辑一样，同理觉得6狼的话收益太小。同想上票9。这时候我的心路历程和他俩一样一样的。<br>9真预言家发言，说查验了我是好人。但是9没有怎么盘6的问题。我没有信他的金水。 我觉得9的验人这个力度从9是好人说没问题，因为上一局我给他上了一票，是正确的验人选择。但是反过来从9狼人说也是存在可能性的，拉拢一个好人进来。另外我觉得2如果是真预言家在2天没死的情况下又2天验出来都是好人，内心当时确实存疑。其实从复盘看，他的验人选择真的就是单纯的真预言家好人的视角的做法没什么多想的，但是当时我和其他好人4、8真的没有认下来他的真预言家身份。<br>8民对于9第一天给他的金水不敢接。且他认为狼人第二天没杀9他心存疑惑。8表示要投票给9。<br>1猎人我，我逻辑和4和5一样也走在相信6的道路上。一方面是信了6，另一方面9的发言似乎没怎么针对过6号。这个我心存疑惑。然后我就balabala一直分析6如果是狼人第一天收益太小的事实，希望大家上票给9。</p>
</li>
<li><p>结果：大家上票给9。9出局，9没有太深入的盘逻辑。</p>
</li>
<li><p>第三天夜晚，狼人选择了杀8号。场上剩下四个人：1猎2狼4民5狼。双狼控场游戏结束。</p>
</li>
</ol>
<h4 id="要点总结"><a href="#要点总结" class="headerlink" title="要点总结"></a>要点总结</h4><ol>
<li><p>狼怎么玩的：<br>6狼（胜利方mvp）给7踩死的查杀。这种其实是根据位置学的反逻辑。用冒着自己的危险踩死7的视角，尝试自己的死换来的是强有力的预言家，表面看坐实的程度不低。<br>2号怂狼没有透出任何信息。<br>5狼略微引导了一下6是预言家的逻辑，但是1猎3巫4民确实是想到一块了（我当时确实从6悍跳预言家收益晓得角度认了6预言家，且在我之前发言的4民也是想到了且发言的），并不是因为跟了5的逻辑。</p>
</li>
<li><p>好人怎么玩的：<br>1猎，3巫，4民：其中这三个都是认为6作为狼人可能的收益很小的角度上，认定6可能是真预言家。后面女巫顺势开毒。其他均给9上票。<br>8民，第一天金水没有接也合理。因为6狼发言没有太大问题，9预言家的金水给8也不一定能坐实9。</p>
</li>
<li><p>这一局的独特性，为什么我总觉得这局好人难赢，为什么说这一局不容易太逆转。</p>
<ol>
<li>首先女巫自救没有银水。少验一个人。</li>
<li>预言家是首置位发言，给8民一个金水。8民是金水正好也是归票位的金水。在8是民的情况下。金水可接可不接。预言家可认可不认。（我觉得这里是在赌概率）。且第二天白天预言家这个发言我觉得有不足。</li>
<li>7号民牌，开不了视角。只能反打6，9号一开始根据位置学轻踩7，能说的大致就那么多。</li>
<li>2和5第一天的弃票是狼人一个重要的破绽，回过头来想想第一天好人正常逻辑大概率是不会弃票，肯定是6和7的局。弃票则说明真的狼面很大。但是为什么这个看起来暴露的弃票行为没有获得理论上足够的重视呢？我理解因为6最后遗言这一手。基本上把所有的思路都引入在真预言家身上=&gt;所有好人的当务之急，或者急需抿身份的思路都是【谁是真预言家】这个问题。如果真是6预9狼。9是要马上要投出去的牌。或者要干掉这个被6验出来的7号或者从位置学上被尴尬的7号。总之好人视角来看，7/9两张牌都有争议。无论是7/9出1狼或者7和9狼踩狼，【排7/9的身份或者狼坑】整体执行优先级都高于对于【好人对弃票的反馈】。</li>
</ol>
</li>
</ol>
<h4 id="为什么这局难以逆转"><a href="#为什么这局难以逆转" class="headerlink" title="为什么这局难以逆转"></a>为什么这局难以逆转</h4><p>如果发生以下条件，那么6号预言家难坐实，局势也不会这么发展。</p>
<ol>
<li>第一天狼人没有刀女巫。换来一个银水。</li>
<li>7号8号两个里面存在一个神。真实情况是7、8两位置连民，都整体缺少视角，7被毒冤死，另8缺少足够信息。</li>
<li>第一天9号真预言家不是第一个发言。且给的不是归票位验人。</li>
<li>真预言家在2天内至少验出来一匹狼。且最好第二天验出来狼。1/2/4/5的身份从头到尾巴除了2/5第一天弃票这个信息。基本上发言没有透露太多信息或者破绽。好人从头到位都有点缺乏信息。</li>
</ol>
<h4 id="这局如果好人想赢，怎么赢："><a href="#这局如果好人想赢，怎么赢：" class="headerlink" title="这局如果好人想赢，怎么赢："></a>这局如果好人想赢，怎么赢：</h4><ol>
<li><p>真预言家9，作为场上唯一有视野的人：</p>
<ol>
<li>努力去向全场好人去仔仔细细盘6号这匹狼的狼人意图。语态上始终坚持狠狠的打死6这只狼不动摇。（我认为这个不太容易让好人相信，但是是必要要尝试去做的不能不这么做。）</li>
<li>努力推进打平衡局的玩法。暂时保住7号。表示自己可以扛出，将7当做反向金水。一定建议让女巫不要毒7，哪怕毒自己，打一个平衡局，自己扛出。走1预1狼平衡局，真预言家出局后续走向纯盘逻辑的局。</li>
</ol>
</li>
<li><p>第二天的金水我接住。认同9号的验人逻辑。就是因为我第一天给他上票他验了我。结果是金水。就是这么回事没什么好说的。然后我转过来思维从剩余的人里面出。</p>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/03/22/%E7%8B%BC%E4%BA%BA%E6%9D%80%E5%A6%82%E4%BD%95%E8%87%B4%E8%83%9C/" data-id="ckfahcydg000gl0dl8gnz5imt" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-linux常用命令" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/02/18/linux%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/" class="article-date">
  <time datetime="2020-02-18T14:56:00.000Z" itemprop="datePublished">2020-02-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Programming-Data/">Programming & Data</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/02/18/linux%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/">Linux常用命令</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
      	<!-- Table of Contents -->
		
        <h2 id="du"><a href="#du" class="headerlink" title="du"></a>du</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">du (disk usage) : 查看磁盘使用空间；</span><br><span class="line">du -sh filename/dirname</span><br></pre></td></tr></table></figure>

<h2 id="nohup"><a href="#nohup" class="headerlink" title="nohup"></a>nohup</h2><ul>
<li>When you execute a Unix job in the background ( using &amp;, bg command), and logout from the session, your process will get killed. You can avoid this using several methods — executing the job with nohup, or making it as batch job using at, batch or cron command. Nohup stands for no hang up, which can be executed as shown below. nohup syntax:<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohup command &amp;</span><br></pre></td></tr></table></figure></li>
<li>Nohup is very helpful when you have to execute a shell-script or command that take a long time to finish. In that case, you don’t want to be connected to the shell and waiting for the command to complete. Instead, execute it with nohup, exit the shell and continue with your other work.<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -aux | grep charm</span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/02/18/linux%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/" data-id="ckfahcydf000dl0dlehp73ngk" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Tensorflow API" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/02/13/Tensorflow%20API/" class="article-date">
  <time datetime="2020-02-13T14:56:00.000Z" itemprop="datePublished">2020-02-13</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Programming-Data/">Programming & Data</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/02/13/Tensorflow%20API/">Tensorflow API</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
      	<!-- Table of Contents -->
		
        <h2 id="tf-nn-embedding-lookup"><a href="#tf-nn-embedding-lookup" class="headerlink" title="tf.nn.embedding_lookup()"></a>tf.nn.embedding_lookup()</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">tf.nn.embedding_lookup(</span><br><span class="line">    params,</span><br><span class="line">    ids,</span><br><span class="line">    partition_strategy=<span class="string">&#x27;mod&#x27;</span>,</span><br><span class="line">    name=<span class="literal">None</span>,</span><br><span class="line">    validate_indices=<span class="literal">True</span>,</span><br><span class="line">    max_norm=<span class="literal">None</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>Looks up ids in a list of embedding tensors. This function is used to perform parallel lookups on the list of tensors in params. It is a generalization of tf.gather, where params is interpreted as a partitioning of a large embedding tensor. params may be a PartitionedVariable as returned by using tf.get_variable() with a partitioner. 按照ids顺序返回params中的第ids行。</p>
<ul>
<li>If len(params) &gt; 1, each element id of ids is partitioned between the elements of params according to the partition_strategy. In all strategies, if the id space does not evenly divide the number of partitions, each of the first (max_id + 1) % len(params) partitions will be assigned one more id.</li>
<li>If partition_strategy is “mod”, we assign each id to partition p = id % len(params). For instance, 13 ids are split across 5 partitions as: [[0, 5, 10], [1, 6, 11], [2, 7, 12], [3, 8], [4, 9]]</li>
<li>If partition_strategy is “div”, we assign ids to partitions in a contiguous manner. In this case, 13 ids are split across 5 partitions as: [[0, 1, 2], [3, 4, 5], [6, 7, 8], [9, 10], [11, 12]]</li>
</ul>
<p>The results of the lookup are concatenated into a dense tensor. The returned tensor has shape shape(ids) + shape(params)[1:].</p>
<p>demo</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">a = np.array(</span><br><span class="line">    [[<span class="number">0.1</span>, <span class="number">0.2</span>, <span class="number">0.3</span>],</span><br><span class="line">     [<span class="number">1.1</span>, <span class="number">1.2</span>, <span class="number">1.3</span>],</span><br><span class="line">     [<span class="number">2.1</span>, <span class="number">2.2</span>, <span class="number">2.3</span>],</span><br><span class="line">     [<span class="number">3.1</span>, <span class="number">3.2</span>, <span class="number">3.3</span>],</span><br><span class="line">     [<span class="number">4.1</span>, <span class="number">4.2</span>, <span class="number">4.3</span>]])</span><br><span class="line">idx1 = tf.Variable([<span class="number">0</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>], tf.int32)</span><br><span class="line">idx2 = tf.Variable([[<span class="number">0</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>], [<span class="number">4</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">2</span>]], tf.int32)</span><br><span class="line">out1 = tf.nn.embedding_lookup(a, idx1)</span><br><span class="line">out2 = tf.nn.embedding_lookup(a, idx2)</span><br><span class="line">init = tf.global_variables_initializer()</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> tf.Session() <span class="keyword">as</span> sess:</span><br><span class="line">    sess.run(init)</span><br><span class="line">    print(a)</span><br><span class="line">    print(<span class="string">&#x27;=========&#x27;</span>)</span><br><span class="line">    print(sess.run(out1))</span><br><span class="line">    print(<span class="string">&#x27;=========&#x27;</span>)</span><br><span class="line">    print(sess.run(out2))</span><br></pre></td></tr></table></figure>
<p>result</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[[<span class="number">0.1</span> <span class="number">0.2</span> <span class="number">0.3</span>]</span><br><span class="line"> [<span class="number">1.1</span> <span class="number">1.2</span> <span class="number">1.3</span>]</span><br><span class="line"> [<span class="number">2.1</span> <span class="number">2.2</span> <span class="number">2.3</span>]</span><br><span class="line"> [<span class="number">3.1</span> <span class="number">3.2</span> <span class="number">3.3</span>]</span><br><span class="line"> [<span class="number">4.1</span> <span class="number">4.2</span> <span class="number">4.3</span>]]</span><br><span class="line">=========</span><br><span class="line">[[<span class="number">0.1</span> <span class="number">0.2</span> <span class="number">0.3</span>]</span><br><span class="line"> [<span class="number">2.1</span> <span class="number">2.2</span> <span class="number">2.3</span>]</span><br><span class="line"> [<span class="number">3.1</span> <span class="number">3.2</span> <span class="number">3.3</span>]</span><br><span class="line"> [<span class="number">1.1</span> <span class="number">1.2</span> <span class="number">1.3</span>]]</span><br><span class="line">=========</span><br><span class="line">[[[<span class="number">0.1</span> <span class="number">0.2</span> <span class="number">0.3</span>]</span><br><span class="line">  [<span class="number">2.1</span> <span class="number">2.2</span> <span class="number">2.3</span>]</span><br><span class="line">  [<span class="number">3.1</span> <span class="number">3.2</span> <span class="number">3.3</span>]</span><br><span class="line">  [<span class="number">1.1</span> <span class="number">1.2</span> <span class="number">1.3</span>]]</span><br><span class="line"> [[<span class="number">4.1</span> <span class="number">4.2</span> <span class="number">4.3</span>]</span><br><span class="line">  [<span class="number">0.1</span> <span class="number">0.2</span> <span class="number">0.3</span>]</span><br><span class="line">  [<span class="number">2.1</span> <span class="number">2.2</span> <span class="number">2.3</span>]</span><br><span class="line">  [<span class="number">2.1</span> <span class="number">2.2</span> <span class="number">2.3</span>]]]</span><br></pre></td></tr></table></figure>


<h2 id="tf-sequence-mask"><a href="#tf-sequence-mask" class="headerlink" title="tf.sequence_mask"></a>tf.sequence_mask</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">tf.sequence_mask(</span><br><span class="line">    lengths,</span><br><span class="line">    maxlen=<span class="literal">None</span>,</span><br><span class="line">    dtype=tf.bool,</span><br><span class="line">    name=<span class="literal">None</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>Returns a mask tensor representing the first N positions of each cell. If lengths has shape [d_1, d_2, …, d_n] the resulting tensor mask has dtype dtype and shape [d_1, d_2, …, d_n, maxlen], with<br>mask[i_1, i_2, …, i_n, j] = (j &lt; lengths[i_1, i_2, …, i_n])</p>
<p>Examples:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tf.sequence_mask([<span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>], <span class="number">5</span>) </span><br><span class="line"><span class="comment"># [[True, False, False, False, False], </span></span><br><span class="line"><span class="comment"># [True, True, True, False, False], </span></span><br><span class="line"><span class="comment"># [True, True, False, False, False]] </span></span><br></pre></td></tr></table></figure>
<p>另外</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">tf.sequence_mask([[<span class="number">1</span>, <span class="number">3</span>],[<span class="number">2</span>,<span class="number">0</span>]]) </span><br><span class="line"><span class="comment"># [[[True, False, False], </span></span><br><span class="line"><span class="comment"># [True, True, True]], </span></span><br><span class="line"><span class="comment"># [[True, True, False], </span></span><br><span class="line"><span class="comment"># [False, False, False]]]</span></span><br></pre></td></tr></table></figure>

<h2 id="tf-expand-dims"><a href="#tf-expand-dims" class="headerlink" title="tf.expand_dims"></a>tf.expand_dims</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">tf.expand_dims( </span><br><span class="line">    input, </span><br><span class="line">    axis=<span class="literal">None</span>, </span><br><span class="line">    name=<span class="literal">None</span>, </span><br><span class="line">    dim=<span class="literal">None</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>See the guide: Tensor Transformations &gt; Shapes and Shaping</p>
<p>Inserts a dimension of 1 into a tensor’s shape.</p>
<p>Given a tensor input, this operation inserts a dimension of 1 at the dimension index axis of input’s shape. The dimension index axis starts at zero; if you specify a negative number for axis it is counted backward from the end.</p>
<p>This operation is useful if you want to add a batch dimension to a single element. For example, if you have a single image of shape [height, width, channels], you can make it a batch of 1 image with expand_dims(image, 0), which will make the shape [1, height, width, channels].</p>
<p>Other examples:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># &#x27;t&#x27; is a tensor of shape [2]</span></span><br><span class="line">tf.shape(tf.expand_dims(t, <span class="number">0</span>))  <span class="comment"># [1, 2]</span></span><br><span class="line">tf.shape(tf.expand_dims(t, <span class="number">1</span>))  <span class="comment"># [2, 1]</span></span><br><span class="line">tf.shape(tf.expand_dims(t, <span class="number">-1</span>))  <span class="comment"># [2, 1]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># &#x27;t2&#x27; is a tensor of shape [2, 3, 5]</span></span><br><span class="line">tf.shape(tf.expand_dims(t2, <span class="number">0</span>))  <span class="comment"># [1, 2, 3, 5]</span></span><br><span class="line">tf.shape(tf.expand_dims(t2, <span class="number">2</span>))  <span class="comment"># [2, 3, 1, 5]</span></span><br><span class="line">tf.shape(tf.expand_dims(t2, <span class="number">3</span>))  <span class="comment"># [2, 3, 5, 1]</span></span><br></pre></td></tr></table></figure>
<p>This operation requires that:</p>
<p>-1-input.dims() &lt;= dim &lt;= input.dims()</p>
<p>This operation is related to squeeze(), which removes dimensions of size 1.</p>
<h2 id="tf-gather"><a href="#tf-gather" class="headerlink" title="tf.gather()"></a>tf.gather()</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">tf.gather( </span><br><span class="line">    params, </span><br><span class="line">    indices, </span><br><span class="line">    validate_indices=<span class="literal">None</span>,</span><br><span class="line">    name=<span class="literal">None</span>, </span><br><span class="line">    axis=<span class="number">0</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>indices must be an integer tensor of any dimension (usually 0-D or 1-D). Produces an output tensor with shape params.shape[:axis] + indices.shape + params.shape[axis + 1:] where:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line">x = tf.range(<span class="number">0</span>, <span class="number">10</span>)*<span class="number">10</span> + tf.constant(<span class="number">1</span>, shape=[<span class="number">10</span>])</span><br><span class="line">y = tf.gather(x, [<span class="number">1</span>, <span class="number">5</span>, <span class="number">9</span>])</span><br><span class="line"><span class="keyword">with</span> tf.Session() <span class="keyword">as</span> sess:</span><br><span class="line">    print(sess.run(x))</span><br><span class="line">    print(sess.run(y))</span><br></pre></td></tr></table></figure>

<p>result</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[ <span class="number">1</span> <span class="number">11</span> <span class="number">21</span> <span class="number">31</span> <span class="number">41</span> <span class="number">51</span> <span class="number">61</span> <span class="number">71</span> <span class="number">81</span> <span class="number">91</span>]</span><br><span class="line">[<span class="number">11</span> <span class="number">51</span> <span class="number">91</span>]</span><br></pre></td></tr></table></figure>


<h2 id="tf-reshape"><a href="#tf-reshape" class="headerlink" title="tf.reshape()"></a>tf.reshape()</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">tf.reshape(</span><br><span class="line">    tensor,</span><br><span class="line">    shape,</span><br><span class="line">    name=<span class="literal">None</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>Given tensor, this operation returns a tensor that has the same values as tensor with shape shape.</p>
<p>If one component of shape is the special value -1, the size of that dimension is computed so that the total size remains constant. In particular, a shape of [-1] flattens into 1-D. At most one component of shape can be -1.　If shape is 1-D or higher, then the operation returns a tensor with shape shape filled with the values of tensor. In this case, the number of elements implied by shape must be the same as the number of elements in tensor.</p>
<p>demo</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">a = tf.constant(np.array(list(range(<span class="number">1</span>, <span class="number">9</span>+<span class="number">1</span>, <span class="number">1</span>))))</span><br><span class="line">b = tf.reshape(a, [<span class="number">3</span>, <span class="number">3</span>])</span><br><span class="line"><span class="comment"># t: a (3 x 2 x 3) tensor</span></span><br><span class="line">t = tf.constant(</span><br><span class="line">    [[[<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>],</span><br><span class="line">      [<span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>]],</span><br><span class="line">     [[<span class="number">3</span>, <span class="number">3</span>, <span class="number">3</span>],</span><br><span class="line">      [<span class="number">4</span>, <span class="number">4</span>, <span class="number">4</span>]],</span><br><span class="line">     [[<span class="number">5</span>, <span class="number">5</span>, <span class="number">5</span>],</span><br><span class="line">      [<span class="number">6</span>, <span class="number">6</span>, <span class="number">6</span>]]]</span><br><span class="line">)</span><br><span class="line">c = tf.reshape(t, [<span class="number">2</span>, <span class="number">-1</span>])</span><br><span class="line">d = tf.reshape(t, [<span class="number">-1</span>, <span class="number">9</span>])</span><br><span class="line">e = tf.reshape(t, [<span class="number">2</span>, <span class="number">-1</span>, <span class="number">3</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> tf.Session() <span class="keyword">as</span> sess:</span><br><span class="line">    print(sess.run(a), end=<span class="string">&#x27;\n\n&#x27;</span>)</span><br><span class="line">    print(sess.run(b), end=<span class="string">&#x27;\n\n&#x27;</span>)</span><br><span class="line">    print(b.get_shape().as_list())</span><br><span class="line">    print(sess.run(t), end=<span class="string">&#x27;\n\n&#x27;</span>)</span><br><span class="line">    print(t.get_shape().as_list())</span><br><span class="line">    print(sess.run(c), end=<span class="string">&#x27;\n\n&#x27;</span>)</span><br><span class="line">    print(c.get_shape().as_list())</span><br><span class="line">    print(sess.run(d), end=<span class="string">&#x27;\n\n&#x27;</span>)</span><br><span class="line">    print(d.get_shape().as_list())</span><br><span class="line">    print(sess.run(e), end=<span class="string">&#x27;\n\n&#x27;</span>)</span><br><span class="line">    print(e.get_shape().as_list())</span><br></pre></td></tr></table></figure>
<p>result</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[[<span class="number">1</span> <span class="number">2</span> <span class="number">3</span>]</span><br><span class="line"> [<span class="number">4</span> <span class="number">5</span> <span class="number">6</span>]]</span><br><span class="line"></span><br><span class="line">[[<span class="number">1</span> <span class="number">4</span>]</span><br><span class="line"> [<span class="number">2</span> <span class="number">5</span>]</span><br><span class="line"> [<span class="number">3</span> <span class="number">6</span>]]</span><br><span class="line"></span><br><span class="line">[[<span class="number">1</span> <span class="number">4</span>]</span><br><span class="line"> [<span class="number">2</span> <span class="number">5</span>]</span><br><span class="line"> [<span class="number">3</span> <span class="number">6</span>]]</span><br><span class="line"></span><br><span class="line">[[[ <span class="number">1</span>  <span class="number">2</span>  <span class="number">3</span>]</span><br><span class="line">  [ <span class="number">4</span>  <span class="number">5</span>  <span class="number">6</span>]]</span><br><span class="line"></span><br><span class="line"> [[ <span class="number">7</span>  <span class="number">8</span>  <span class="number">9</span>]</span><br><span class="line">  [<span class="number">10</span> <span class="number">11</span> <span class="number">12</span>]]]</span><br><span class="line"></span><br><span class="line">[<span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"></span><br><span class="line">[[[ <span class="number">1</span>  <span class="number">4</span>]</span><br><span class="line">  [ <span class="number">2</span>  <span class="number">5</span>]</span><br><span class="line">  [ <span class="number">3</span>  <span class="number">6</span>]]</span><br><span class="line"></span><br><span class="line"> [[ <span class="number">7</span> <span class="number">10</span>]</span><br><span class="line">  [ <span class="number">8</span> <span class="number">11</span>]</span><br><span class="line">  [ <span class="number">9</span> <span class="number">12</span>]]]</span><br><span class="line"></span><br><span class="line">[<span class="number">2</span>, <span class="number">3</span>, <span class="number">2</span>]</span><br></pre></td></tr></table></figure>

<h2 id="tf-split"><a href="#tf-split" class="headerlink" title="tf.split()"></a>tf.split()</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">tf.split(</span><br><span class="line">    value,</span><br><span class="line">    num_or_size_splits,</span><br><span class="line">    axis=<span class="number">0</span>,</span><br><span class="line">    num=<span class="literal">None</span>,</span><br><span class="line">    name=<span class="string">&#x27;split&#x27;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>Splits a tensor into sub tensors.</p>
<p>If num_or_size_splits is an integer type, num_split, then splits value along dimension axis into num_split smaller tensors. Requires that num_split evenly divides value.shape[axis]. If num_or_size_splits is not an integer type, it is presumed to be a Tensor size_splits, then splits value into len(size_splits) pieces. The shape of the i-th piece has the same size as the value except along dimension axis where the size is size_splits[i].</p>
<p>demo</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">a = tf.constant(np.reshape(list(range(<span class="number">1</span>, <span class="number">6</span>+<span class="number">1</span>, <span class="number">1</span>)), (<span class="number">2</span>, <span class="number">3</span>)))</span><br><span class="line">b1, b2, b3 = tf.split(a, <span class="number">3</span>, axis=<span class="number">1</span>)</span><br><span class="line">d1, d2, d3 = tf.split(a, [<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>], axis=<span class="number">1</span>)</span><br><span class="line">c1, c2 = tf.split(a, [<span class="number">1</span>, <span class="number">2</span>], axis=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> tf.Session() <span class="keyword">as</span> sess:</span><br><span class="line">    print(sess.run(a), end=<span class="string">&#x27;\n\n&#x27;</span>)</span><br><span class="line">    print(sess.run(b1), end=<span class="string">&#x27;\n\n&#x27;</span>)</span><br><span class="line">    print(sess.run(b2), end=<span class="string">&#x27;\n\n&#x27;</span>)</span><br><span class="line">    print(sess.run(b3), end=<span class="string">&#x27;\n\n&#x27;</span>)</span><br><span class="line">    print(sess.run(d1), end=<span class="string">&#x27;\n\n&#x27;</span>)</span><br><span class="line">    print(sess.run(d2), end=<span class="string">&#x27;\n\n&#x27;</span>)</span><br><span class="line">    print(sess.run(d3), end=<span class="string">&#x27;\n\n&#x27;</span>)</span><br><span class="line">    print(sess.run(c1), end=<span class="string">&#x27;\n\n&#x27;</span>)</span><br><span class="line">    print(sess.run(c2), end=<span class="string">&#x27;\n\n&#x27;</span>)</span><br><span class="line">result</span><br><span class="line">[[<span class="number">1</span> <span class="number">2</span> <span class="number">3</span>]</span><br><span class="line"> [<span class="number">4</span> <span class="number">5</span> <span class="number">6</span>]]</span><br><span class="line"></span><br><span class="line">[[<span class="number">1</span>]</span><br><span class="line"> [<span class="number">4</span>]]</span><br><span class="line"></span><br><span class="line">[[<span class="number">2</span>]</span><br><span class="line"> [<span class="number">5</span>]]</span><br><span class="line"></span><br><span class="line">[[<span class="number">3</span>]</span><br><span class="line"> [<span class="number">6</span>]]</span><br><span class="line"></span><br><span class="line">[[<span class="number">1</span>]</span><br><span class="line"> [<span class="number">4</span>]]</span><br><span class="line"></span><br><span class="line">[[<span class="number">2</span>]</span><br><span class="line"> [<span class="number">5</span>]]</span><br><span class="line"></span><br><span class="line">[[<span class="number">3</span>]</span><br><span class="line"> [<span class="number">6</span>]]</span><br><span class="line"></span><br><span class="line">[[<span class="number">1</span>]</span><br><span class="line"> [<span class="number">4</span>]]</span><br><span class="line"></span><br><span class="line">[[<span class="number">2</span> <span class="number">3</span>]</span><br><span class="line"> [<span class="number">5</span> <span class="number">6</span>]]</span><br></pre></td></tr></table></figure>

<h2 id="tf-transpose"><a href="#tf-transpose" class="headerlink" title="tf.transpose()"></a>tf.transpose()</h2><p>demo</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">a = tf.constant(</span><br><span class="line">    [[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>],</span><br><span class="line">     [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]]</span><br><span class="line">)</span><br><span class="line">b = tf.transpose(a)</span><br><span class="line"><span class="comment"># equivaltently</span></span><br><span class="line">c = tf.transpose(a, [<span class="number">1</span>, <span class="number">0</span>])</span><br><span class="line"><span class="comment"># x : 2 x 2 x 3</span></span><br><span class="line">x = tf.constant(</span><br><span class="line">    [[[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>],</span><br><span class="line">      [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]],</span><br><span class="line">     [[<span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>],</span><br><span class="line">      [<span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>]]]</span><br><span class="line">)</span><br><span class="line"><span class="comment"># perm is more useful for n-dimensional tersors, for n &gt; 2</span></span><br><span class="line"><span class="comment"># y : 2 x 3 x 2</span></span><br><span class="line">y = tf.transpose(x, perm=[<span class="number">0</span>, <span class="number">2</span>, <span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> tf.Session() <span class="keyword">as</span> sess:</span><br><span class="line">    print(sess.run(a), end=<span class="string">&#x27;\n\n&#x27;</span>)</span><br><span class="line">    print(sess.run(b), end=<span class="string">&#x27;\n\n&#x27;</span>)</span><br><span class="line">    print(sess.run(c), end=<span class="string">&#x27;\n\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    print(sess.run(x), end=<span class="string">&#x27;\n\n&#x27;</span>)</span><br><span class="line">    print(x.get_shape().as_list(), end=<span class="string">&#x27;\n\n&#x27;</span>)</span><br><span class="line">    print(sess.run(y), end=<span class="string">&#x27;\n\n&#x27;</span>)</span><br><span class="line">    print(y.get_shape().as_list(), end=<span class="string">&#x27;\n\n&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>result</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[[<span class="number">1</span> <span class="number">2</span> <span class="number">3</span>]</span><br><span class="line"> [<span class="number">4</span> <span class="number">5</span> <span class="number">6</span>]]</span><br><span class="line"></span><br><span class="line">[[<span class="number">1</span> <span class="number">4</span>]</span><br><span class="line"> [<span class="number">2</span> <span class="number">5</span>]</span><br><span class="line"> [<span class="number">3</span> <span class="number">6</span>]]</span><br><span class="line"></span><br><span class="line">[[<span class="number">1</span> <span class="number">4</span>]</span><br><span class="line"> [<span class="number">2</span> <span class="number">5</span>]</span><br><span class="line"> [<span class="number">3</span> <span class="number">6</span>]]</span><br><span class="line"></span><br><span class="line">[[[ <span class="number">1</span>  <span class="number">2</span>  <span class="number">3</span>]</span><br><span class="line">  [ <span class="number">4</span>  <span class="number">5</span>  <span class="number">6</span>]]</span><br><span class="line"></span><br><span class="line"> [[ <span class="number">7</span>  <span class="number">8</span>  <span class="number">9</span>]</span><br><span class="line">  [<span class="number">10</span> <span class="number">11</span> <span class="number">12</span>]]]</span><br><span class="line"></span><br><span class="line">[<span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/02/13/Tensorflow%20API/" data-id="ckfahcyda0008l0dl277ggwml" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Yoshua Bengio对ML研究者的建议" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/01/11/Yoshua%20Bengio%E5%AF%B9ML%E7%A0%94%E7%A9%B6%E8%80%85%E7%9A%84%E5%BB%BA%E8%AE%AE/" class="article-date">
  <time datetime="2020-01-11T12:11:00.000Z" itemprop="datePublished">2020-01-11</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E7%BB%8F%E9%AA%8C%E6%80%BB%E7%BB%93/">经验总结</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/01/11/Yoshua%20Bengio%E5%AF%B9ML%E7%A0%94%E7%A9%B6%E8%80%85%E7%9A%84%E5%BB%BA%E8%AE%AE/">Yoshua Bengio对ML研究者的建议</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
      	<!-- Table of Contents -->
		
        <h2 id="Quora原始问题"><a href="#Quora原始问题" class="headerlink" title="Quora原始问题"></a>Quora原始问题</h2><p>Originally Answered: Yoshua Bengio: What advise do you have for young researchers entering the field of Machine Learning?</p>
<p>对话Yoshua Bengio：对年轻机器学习领域的研究者的建议？</p>
<p>Make sure you have a strong training in math and computer science (including the practical part, i.e., programming). Read books and (lots of) papers but that is not enough: you need to develop your intuitions by </p>
<p>(a) programming a bunch of learning algorithms yourself, e.g., trying to reproduce existing papers, and </p>
<p>(b) by learning to tune hyper-parameters and explore variants (in architecture, objective function, etc.), e.g., by participating in competitions or trying to improve on published results once you have been able to reproduce them. Then, find collaborators with whom you can brainstorm about ideas and share the workload involved in exploring and testing new ideas.  Working with an existing group is ideal, of course, or recruit your own students to work on this with you, if you are a faculty.</p>
<p>四个核心能力</p>
<ul>
<li>确保数学和计算机学科扎实训练（包括实践部分，即编程)</li>
<li>阅读书籍和很多论文</li>
<li>在阅读论文的基础上（a）自己编写一堆学习算法来发展自己的直觉，例如尝试复制现有的论文，（b）通过学习调参和探索变体（在模型结构，目标函数等），例如通过参与竞赛或尝试改进已发表的结果，一旦你能够重现它们。</li>
<li>找到小伙伴与他们头脑风暴，分享探索和测试新想法的相关工作。如果是教师，与现有团队合作当然是很理想的，或者招募学生与一起工作。</li>
</ul>
<h2 id="Preference"><a href="#Preference" class="headerlink" title="Preference"></a>Preference</h2><p><a target="_blank" rel="noopener" href="https://www.quora.com/bookmarked_answers">https://www.quora.com/bookmarked_answers</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/01/11/Yoshua%20Bengio%E5%AF%B9ML%E7%A0%94%E7%A9%B6%E8%80%85%E7%9A%84%E5%BB%BA%E8%AE%AE/" data-id="ckfahcydd000cl0dl9btkf8zw" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-2019年度总结" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/01/02/2019%E5%B9%B4%E5%BA%A6%E6%80%BB%E7%BB%93/" class="article-date">
  <time datetime="2020-01-02T07:11:00.000Z" itemprop="datePublished">2020-01-02</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E7%BB%8F%E9%AA%8C%E6%80%BB%E7%BB%93/">经验总结</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/01/02/2019%E5%B9%B4%E5%BA%A6%E6%80%BB%E7%BB%93/">2019年度总结</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
      	<!-- Table of Contents -->
		
        <h2 id="年度关键词"><a href="#年度关键词" class="headerlink" title="年度关键词"></a>年度关键词</h2><ul>
<li>今年给自己的年度关键词是： 入局</li>
</ul>
<h2 id="旅游"><a href="#旅游" class="headerlink" title="旅游"></a>旅游</h2><h5 id="拉萨"><a href="#拉萨" class="headerlink" title="拉萨"></a>拉萨</h5><p>西藏整体印象是圣洁、无污染、纯净。布达拉宫内有乾坤，里面有佛教文化中一切元素，能唤起藏区统治者那种具备强信仰，却又因为是王室的诸多无奈之情，宫殿里面巨大的陵墓让人震撼，感觉还是无论是生是死，都是在追求内心中的一种平静。藏区民众就像他们的牦牛一样，性格温顺，虔诚，丝毫没有感受到少数冲突分子的暴乱、动荡。高原反应：所谓高原反应，好比长期不运动跑了1000米之后，自然喘气会大口大口喘气，但是过一会就会恢复，类似这样一种感觉。在持续向上爬坡或者快速前进的时候会很快有这种感觉。</p>
<h5 id="林芝"><a href="#林芝" class="headerlink" title="林芝"></a>林芝</h5><p>塞上江南，海拔比拉萨低不少高反弱很多，能较好地适应大多数人的需求。景色的美在于结合了远方的雪山和近处的绿水，绿水和桂林遇龙河有点类似，但是远方的雪山加持上感觉美的更立体。最美的地方在于南迦巴瓦峰，中国最美山峰Top1感觉应该是实至名归（区分清楚是“山峰”，不是“山”），海拔不到8000，号称羞女峰，那个峰尖长期是云雾缭绕，基本上不能完全看到全貌，我这算是足够幸运，拍到了完整的山尖，并且拍照时真好是太阳金光一渡，美好瞬间来的突然去的更快，也就持续几分钟。到了晚上之后，南迦巴瓦依然云雾缭绕，远远望去仔细看了十多分钟，感觉那个山峰上面绝对是阴森恐怖，云雾缭绕，假如晚上爬在上面心里恐惧肯定是一个巨大问题。后来回了北京再看南迦巴瓦的照片，那种怀念的感觉迟迟散不了，做梦也梦见过好几次，但用“美”这种字眼描述不出来那种难忘的感觉，梦里面的南迦巴瓦，感觉已经称为一种心结，这种感觉在目前为止所有去过的地方里面都基本没有。</p>
<h5 id="纳木措-amp-羊卓雍措"><a href="#纳木措-amp-羊卓雍措" class="headerlink" title="纳木措 &amp; 羊卓雍措"></a>纳木措 &amp; 羊卓雍措</h5><p>这两个是三大圣湖的其中两个，去的路上都是4-5个小时车程，来回9-10个小时成本可以说极高，而且中间有断路仔细想想那根本不是路，颠簸2个小时都快要起飞了，中间游览也就2小时，但整体感觉还是挺值的，和抱有期待和兴趣有关，同时这两个湖确实是平静的让人不知道该说什么好，手上快速的拍下一个个的照片，但是说实话没几张满意的，可能是设备不行吧好多感觉相片上完全不出来。两大圣湖美的原因还是距离生活区非常元，距离人住的地方实在是有距离，这样也保证了超强的抗污染。印象比较深的是和藏獒合影，藏獒在人们心目中是非常凶的动物，我当时因为拍了和2只藏獒的合影心里面秀的一逼，但仔细想想藏獒的雄伟早就被人的驯化所磨灭，可以说没有一丝雄气，动物内在个性还不如一只家养的猫来的傲娇。当地人喊一句蹲下马上蹲下，从来没有见过一种动物能被驯化的那么没脾气。人类最强的地方就是“驯化”，有一百种方法让有个性的生灵变成机器般的产物，这么一想这张看似牛逼的藏獒合影照片，真的是没多大意思。另外就是抱着小羊拍照片的那个，拍出来效果很不错，藏家小女孩拍的很开心，我非常满意。有个细节当时小女孩子因为多拍了一个动作想多问我收10快钱，但是她妈妈之前收了我的钱就马上拒绝了，可见这些藏民还是虽然是赚钱还是很有原则的。</p>
<h5 id="飞机回家的路上"><a href="#飞机回家的路上" class="headerlink" title="飞机回家的路上"></a>飞机回家的路上</h5><p>旁边坐了一个藏民老爷爷，皮肤黝黑，目光顺着窗口望出去，不知道是不是第一次坐飞机。空姐发餐食和饮料的时候没有说话摆手不要，一下让我想起了我姥爷在的时候。瞬间眼泪刷刷的实在是难以控制，我在吃完米饭的时候藏民老爷爷还主动帮我把餐盒递给了空姐。下了飞机在银川候机换乘，心情久久难以平静，一个人吃了那个很酸的宁夏酸奶缓了好一会儿。</p>
<h5 id="同行的人"><a href="#同行的人" class="headerlink" title="同行的人"></a>同行的人</h5><p>认识的人有好几个，印象深刻的有一个西安的大厨，三个温州的女生，一个飞韩国的导游，一个住在美国小姐姐，一个也是太原做旅游的女生，还有几个其他人。来西藏旅游的基本上是两类，一类是刚辞职有时间出来玩的，另一类是真有点钱且为了n年前的一个目标过来的（没错我是第二种），这部分人有个共性：真的是有想法、能执行的一批人，这点毋庸置疑，认识几个这种人加了微信，感觉自己心态开阔了许多。来西藏多多少少也是一次克服恐惧的过程，因为能让人恐惧的东西，就是具有未知性的东西，你不知道来了不会不会有高原反应、藏独分子这些，当你真的来了，才是真正体会这些rumors是真rumors还是reality。总之，独自一人去一次西藏，对自我产生更强烈的认同，也会想的更清楚自己到底是怎样的一类人：简单来说就是那种有自己的想法，有执行，十分十分注重自我体验的那种人。</p>
<h5 id="东极岛"><a href="#东极岛" class="headerlink" title="东极岛"></a>东极岛</h5><p>大陆最东的岛屿，太平洋的光最先照耀到这里。前面这句话是韩寒写的很有感觉，但是实地去感受相当一般，垃圾很多，开发也不完善，相应的娱乐设施也乏善可陈。梭子蟹卖的很贵，感觉也不怎么好吃。酒吧老板娘始终不让我们在里面吃饭，让人极其讨厌；岛上一碗面基本上是拉面+半个梭子蟹壳，可以说是高价且毫无亮点。除了和算法团队小伙伴留下比较不错的合影留念，景点强烈不推荐。旅游业的发展不是一件简单的东西，提升管理质量本身的意义可能比本来具备的资源更加重要。如果让我做的话，我可能先从调整这些商家的态度入手，真正做到客户第一，再考虑调优盈利结构。</p>
<h5 id="上海"><a href="#上海" class="headerlink" title="上海"></a>上海</h5><p>真·故地重游，这次针对性的吃了不少上海的特色美食，和几个小伙伴在外滩照了照片，秀的那是十分的开心。我始终感觉外滩美景的大气没有重庆那种三江汇聚来的大气。不过上海确实是现代感非常强，不是国内任意一个城市可以比拟的。</p>
<h2 id="工作总结（算法工程师的第一个半年）"><a href="#工作总结（算法工程师的第一个半年）" class="headerlink" title="工作总结（算法工程师的第一个半年）"></a>工作总结（算法工程师的第一个半年）</h2><p>从两条线进行总结，一条线是以时间线，梳理每个项目做的点；另一条是经验线，总结的是工作方法论上可以提升的点。</p>
<h5 id="落地一淘猜你喜欢迁移学习项目"><a href="#落地一淘猜你喜欢迁移学习项目" class="headerlink" title="落地一淘猜你喜欢迁移学习项目"></a>落地一淘猜你喜欢迁移学习项目</h5><p>年初实习项目，主要把迁移学习模型在猜你喜欢场景落地，效果上相比Local模型取得提升。核心点是利用Global信息更好地刻画C端用户全局兴趣；这个项目本来在2018年年末完成，相比预期有一定的delay，主要原因是2018年末对tensorflow的一些API使用还是不够熟悉踩了一些坑，不过最终还是拿到了比较稳定的收益。项目结束后也同时抛出一个潜在优化点，能否设计更优雅的结构容纳Global信息，或者蒸馏已有Global网络萃取出Global兴趣分布，充分降低模型的复杂度的同事达到类似的精度，后续因为完成毕业论文的原因没有再继续深究。</p>
<h5 id="完成硕士毕业论文-amp-答辩"><a href="#完成硕士毕业论文-amp-答辩" class="headerlink" title="完成硕士毕业论文 &amp; 答辩"></a>完成硕士毕业论文 &amp; 答辩</h5><p>将自己硕士期间的很多工作和探索总结在了论文里面，基本上每一部分内容都把自己想要体现的内容，包括四个部分（室内定位理论+机器学习方法在Wi-Fi定位任务的应用+数据分布探索+对比实验的设计思想和论证过程）并且尽可能清楚地体现到论文内容当中，可以说是对自己硕士三年的一个沉淀。</p>
<h5 id="落地ToB端推荐项目"><a href="#落地ToB端推荐项目" class="headerlink" title="落地ToB端推荐项目"></a>落地ToB端推荐项目</h5><p>一期二期探索ToB推荐的方法论，不同于常规的ToC推荐，B端推荐需要刻画的B背后的人群结构信息，并且需要去从模拟推广者选品视角，需要引入领域知识作为辅助。需要拆分B下人群结构以及背后的需求。做的过程中有很多地方进行了比较反复的讨论和尝试，重点在三个问题上上有所停滞，<br>     1.如何定义抽象的媒体推广意愿<br>     2.如何离线验证模型起到的效果。<br>     3.如何保证数据产生的效率。（排序阶段特征提取和模型训练过程和召回结果对接的时产生过性能问题）。工作方法论总结放在下面的部分。</p>
<h5 id="参加试用期转正答辩"><a href="#参加试用期转正答辩" class="headerlink" title="参加试用期转正答辩"></a>参加试用期转正答辩</h5><ul>
<li>目前主要存在的问题：遇到问题处于太过纠结的状态，需要高效地走到解决问题的途径上，不要把一个问题的细节梳理的清清楚楚再解决（事实上你也不可能一下就梳理清楚）；简单来说对我目前的情况而言：只抓核心要素即可、直白地问问题、聚焦当前的问题；</li>
<li>转变一种态度：承认人都是需要帮助的（这是正常不过的、再牛的人也是这样的），永远不要承认自己总能独立解决问题这个事实（事实上也不是正确的），再多和领导多沟通益处很大（我是有这样做，但还能做的更好，这里对我的收益空间非常大）；</li>
<li>乐观、轻松、尽情展示的状态是魅力的完美体现和高认可度的源泉；高度谨慎、严谨、犹豫、纠结让人瞬间丧失强能力感；以后尽量维持一种前一种状态进行讲解，不要给人以拘谨的状态感觉。</li>
<li>本次答辩细节有余、抽象大图能力欠缺；解决业务问题的角度而言：抽象能力&gt;&gt;细节能力，更体现一个人的水平；仍然存在ppt文字太多的问题，本质上是抽象能力太差导致的；</li>
<li>答辩的时候不要过多铺开讲技术细节（比如表叔过多重复xx特征、xx训练等细节），受众有时候没法马上明白，他们不是算法研究员，因此千万不要学术化、不要全盘算法化、业务表述业务化、细节表述通俗化效果好很多；</li>
<li>答辩过程来看：整体多视角里面缺少整体GMV这个对我们平台来说最宏观的目标；另外就是“自购行为过滤”这个表述引起老大的误解，本质上是说带有目的性的转化这个含义更接近一些；另外老大鼓励对外技术分享活动中将我们的技术进行分享，但是要注意脱敏；</li>
</ul>
<h5 id="下行ppt商品项目"><a href="#下行ppt商品项目" class="headerlink" title="下行ppt商品项目"></a>下行ppt商品项目</h5><p>ppt项目由于客观因素，导致接入mt数量较小，影响面较小。这个项目总结2个点。<br>1.如何构建离线验证集是保证效果的关键环节，之前的方法论只集中在机器学习模型的效果验证上，其实明确一点，任何算法策略决定的效果保证，都是需要建立相应的验证集和验证指标，有时候需要建立多个验证集和验证指标。同时需要考虑在日常和大促两个截然不同的时间节点，大促期间人的潜在需求会得到充分的释放，可以说类似双11规模的大促期间的成交基本界定了算法效果的上限。同时对于商家来说，对于同样一件商品，都会有和日常截然不同的活动加持。<br>2.货品空间和需求空间的释放。由于项目早期是以品牌为核心因素做优化，因此早期对于品牌限制是略微过分严格，导致货品对应的需求空间没有得到充分地释放。水大鱼大，有时候不加限制带来的自然的结果往往更能适应人群需求的分布。</p>
<h2 id="足球"><a href="#足球" class="headerlink" title="足球"></a>足球</h2><h5 id="最强不过利物浦"><a href="#最强不过利物浦" class="headerlink" title="最强不过利物浦"></a>最强不过利物浦</h5><p>本赛季欧冠留下最深印象的是克洛普领先的利物浦，从三个方面来看。1.攻击线上的化学反应（互补性）。萨拉赫-马内-菲尔米诺三人有着非常良好的化学反应，萨拉赫盘带出色能够把控进攻节奏，马内跑位精准+强力终结+强力斗志当之无愧大腿，菲尔米诺在进攻中具有很强的创造性，再加上奥里吉也意识俱佳，能在此三人的基础上有效的出奇制胜，进攻中以上几人有很强的互补性，具备了欧洲一流的攻击水准。同时两个边后卫跑动能力极强，为进攻增添很多张力，是令人羡慕的进攻体系；2.防线，范戴克一枝独秀，对阵热刺上演1防2的局面，脑子里设想好了西索科是右脚球员，逼西索科用左脚起脚；决赛防孙兴慜，孙速度不弱，范也是快速贴身为主，处理相当冷静，对于箭头人物的进攻特点做足了功课。阿诺德作为年轻小将，对于压力处理的非常好，主场对阵巴萨鸡贼的一个假跑突然传中，必须拍案叫绝，确实在战略层面碾压了巴萨。3.渣叔克洛普，最有激情的德国教练，激情之下是具备极强的表达能力，能将自己的思想渗透到球员在攻防当中的每一次触球选择，在13年不敌拜仁，17不敌皇马之后，19的欧冠中，除了决赛都展现了强大的集体作战能力，坚持疾风暴雨般的团队进攻打法，但是决赛却一反常态踢得非常稳健保守，领先之后进攻线上基本上只把萨拉赫安排在前面，全部队员都集中在体系防守里面。这种级别的赛事，到了最后战略上的保守带来胜利的概率会非常大。</p>
<h5 id="孙兴慜闪耀亚洲之光"><a href="#孙兴慜闪耀亚洲之光" class="headerlink" title="孙兴慜闪耀亚洲之光"></a>孙兴慜闪耀亚洲之光</h5><p>本赛季孙完成了大爆发，正式跻身为英超顶级攻击手，具有很快速的反击推进能力和终结能力。成功背后，他父亲可以说是第一功劳，父亲将培养一名职业运动员当做一个“十年以上的任务”，其决心和执行力都堪称恐怖（抛开足球放眼所有行业、所有角色，这种父亲、这种人都堪称罕见），同时长期提醒孙，你所获得的荣誉都是别人对你的认可，不是你的骄傲的资本。灌输谦虚睿智的态度同时十多年完成一个目标的决心并行，两种品质的并行造就了可能是未来亚洲最成功的球员；</p>
<h5 id="国足四十强赛的停滞"><a href="#国足四十强赛的停滞" class="headerlink" title="国足四十强赛的停滞"></a>国足四十强赛的停滞</h5><p>7-0那场大胜我看出来不少问题，看出了国足攻防两端过于明显的短板，尤其是进攻缺少配合，因此在后面买彩票的时候真的是出奇的稳。四十强赛国足是没有人才。遗憾的是进攻中武磊和艾克森没有配合，中场太缺创造力，后防线更是人才荒漠，再加上里皮用人固执不用冯潇霆等也是同样败笔，固执的用人能够带来冠军，但是在不利的条件下，个人感觉还是得放下以前的一些成见面对当下的问题，冯潇霆之前的比赛确实有个很低级的失误被阿兹蒙，那个丢球确实该骂、该重罚，但是有时候今时不同往日，防线用两个没有经验的小将客观来说真的没法撑起大局（虽然小将联赛表现算不错），个人感觉当时还是暂时重启一下老将效果来的更好。</p>
<h5 id="国安争冠失败"><a href="#国安争冠失败" class="headerlink" title="国安争冠失败"></a>国安争冠失败</h5><p>半程取得最好开局，一度看到希望，但是最终输给上港那场太伤，中途换下施密特始终还是不妥，直接把进攻体系有所瓦解。国家队四十强比赛影响了李可、池忠国两个核心对决上港没上，直接导致被上港中场完全压制，影响太大。有时候机会真的是转瞬消失，本赛季国安阵容感觉是足够拿冠军的，感觉缺少核心战术上稳定性对结果还是有太多不利影响。</p>
<h2 id="锻炼与健康"><a href="#锻炼与健康" class="headerlink" title="锻炼与健康"></a>锻炼与健康</h2><ul>
<li>下半年6-8月份坚持一段时间跑步，后来没能坚持下来；主要原因是项目中间有一段讨论和停滞，同时心里急着出一些成果，然后搁置了锻炼的节奏，仔细回想起来其实推进项目的最好方法就是聚焦核心问题、简化一些处理、放开一些限制，不要被局部的一些细节所缠绕跳不出来，按照项目最根本的目标选择比较简单有效的做法去快速迭代，这样基本上能够比较自然地、有序地进行推进。</li>
<li>今年打了很长时间桌上足球，技术有了明显的进步，开发出来前场防守反击的能力，进球率非常高且让对手心理非常难受，后场进攻右手拉射也偶然有进球，但是力道还是比左手小很多；最重要的一点是无论进攻还是防守，认可“控球的”真正价值，且控球都更加自信了，横向控球能为进攻提供随机性，给防守方带来更多的难度，虽然频繁来回控球有一定的丢球率，但是会增加进攻中的不确定性，长久来看对于进攻效果提升大有好处，有时候必须大胆一些采取更灵活的策略，哪怕失误，但是一旦练成这种手法，进攻的质量会高出一个层次。</li>
<li>病史：8月份突然发烧一次，居然身体都在颤抖，瞬间从37度干到39度高烧不退，连输2天液才好，当时确实是难受吓一跳，特别感谢女朋友陪我去2个医院看病才治好，并且做了比较全面的检查没有什么大碍，医保卡没办下来累计花费1000+RMB，感觉真的挺多；12月份风寒感冒，症状就是鼻塞打喷嚏流鼻涕，身体没有不适，不过周末睡了历史最长的两天，在两天早睡的情况下，第一天睡到了上午11点，第二天睡到下午2点也是破了记录，可能和累计疲劳有关。有几次晚上腹泻，多数原因是快速的吃了太冰的东西，不能急促地吃太冰的东西。</li>
</ul>
<h2 id="社交与活动"><a href="#社交与活动" class="headerlink" title="社交与活动"></a>社交与活动</h2><ul>
<li>技术沙龙。参加技术类的同行交流3次，两次数据挖掘小伙伴聚会，一次听广告专场分享，认识了微博的同行，拓宽很多视野；有收益的是MSRA高的特征工程分享，整体上梳理了所有做特征工程的方法，非常系统，有些Feature Engineering真的非常Trick，slides不对外开放已经总结成相关文档；王博和奥古对于Fintech的分享打开了科技金融的应用的思考；KDD两届Top选手蔡/钟对于数据挖掘中不重复造轮子、以及结构化组织代码的做法也对我深受启发；浪教授对于AutoML的分享对于这项技术的局限性阐述比较清晰具体，不过其存在的一个潜在意义就是对机器学习本身的过程的认知会深化，不再孤立的聚焦在业务本身或者某个模型本身，而是以一种上帝视角理解特征工程-模型学习-部署应用着其中的各个过程我们真正care什么。</li>
<li>家庭聚会。</li>
<li>克莱德曼音乐会。</li>
<li>本科实验室小伙伴聚会。</li>
</ul>
<h2 id="读书"><a href="#读书" class="headerlink" title="读书"></a>读书</h2><p>读书杂多，单独总结，不再赘述。<br>《薛兆丰经济学讲义》《香帅的北大金融学课》《经济学原理》《张居正大传》《英格兰足球为什么总是输》《足球经济学》《电商运营方法论》《营销管理》《美国经济的增长与起落》《菊与刀》《富甲美国：山姆沃尔顿自传》《智能商业》</p>
<h2 id="工作（技术）执行层面方法论总结"><a href="#工作（技术）执行层面方法论总结" class="headerlink" title="工作（技术）执行层面方法论总结"></a>工作（技术）执行层面方法论总结</h2><ul>
<li>高频代码复用。2019年工作中有一个影响效率低的问题是重复写了相似的代码，其实围绕不同的主题做的内容，在核心数据处理逻辑上存在相似性，比如排序阶段统计特征提取同时也能作为选品策略里面的验证集因子；再如在不同算法任务上，用户的静态属性特征和商品的静态属性特征基本上保持非常一致，因此复用已有代码模块，例如特征表或者某个离线指标统计表，并且设计好可复用schema提升工作效率，力争在2020不再多花时间在重复代码开发上。</li>
<li>快速迭代。尽快的上线迭代是推进优化的正确节奏。</li>
<li>固定化特征工程+稀疏特征处理。特征工程决定模型上限，在特征层面基本上是分user、item、context三个大类层面（事实上不管特征有多trick总能够关联到着三个大类上面）；推荐系统或者广告系统任何数据中都存在一定的稀疏的特点，但是解决稀疏性或者冷启动问题无外乎从两个角度去尝试优化：空间+时间。比如空间上引入更丰富的信息刻画用户的全局兴趣（比如引入Global &amp; Local信息迁移学习，再如利用建图的角度汇聚人群需求，或者将单个商品泛化到类目/品牌/店铺这种side_info的embedding学习，再或者根据i2i的结果进行特征层面的泛化），时间上拉长周期维度去完整刻画用户长期兴趣。</li>
<li>离线验证方法沉淀。无论是确定性的算法任务（例如CTR预估），还是对抽象的算法目标（优化某个选品策略），都要无一例外的建立离线验证集。有时候需要从不同角度出发建立多个验证集。培养从数据层面抽象业务目标的能力：对于比较抽象的优化目标，必要时需要使用强相关性数据指标进行模拟和逼近，这种时候需要大胆的进行尝试和验证，哪怕是从来没有人这么干过的方法；常规电商算法命题，离线覆盖率是一种比较保守而有效的做法。例如TopGMV覆盖率/nextDay覆盖率/Top seller覆盖率/市场占有率等。</li>
<li>人肉case级检查。除离线验证和线上切流两类方法。人肉case检查也是非常重要的一类方法，主要是从直觉上验证当前的算法效果是不是符合我的感官上的预期，有没有奇奇怪怪的case，有没有处理不够优雅的case。人肉case级检查最好是有师兄或者其他同事一起来看。</li>
<li>留心处处皆学问。感觉最好的学习方式就是把工作和生活中每个环节都以学习的方式多多参与思考、讨论和笔记总结。记下来每个人care的目标，为了达到目标采取的做法。可以是某个大牛，也可以是周围的同事。可以是某个产品/运营，可以是某个文字稿，甚至可以是某个app上的老铁/主播。</li>
<li>Face to Face。当面沟通，与他对话，问他问题，问入骨髓。无论是什么学习场合，当面说清楚还是最好的理解方法，当然沟通完最好是以笔记的形式整理思维。但是能当面一定不要拐弯抹角。</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/01/02/2019%E5%B9%B4%E5%BA%A6%E6%80%BB%E7%BB%93/" data-id="ckfahcydm000sl0dl83pqaru1" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Data Analysis Tutorial" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/12/11/Data%20Analysis%20Tutorial/" class="article-date">
  <time datetime="2019-12-11T12:11:00.000Z" itemprop="datePublished">2019-12-11</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Programming-Data/">Programming & Data</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/12/11/Data%20Analysis%20Tutorial/">Data Analysis Tutorial</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
      	<!-- Table of Contents -->
		
        <h2 id="Why-data-matters"><a href="#Why-data-matters" class="headerlink" title="Why data matters?"></a>Why data matters?</h2><ul>
<li>显著提高工作效率。数据处理是算法工程师日常工作中时间占比最高的部分，故是工作提效最关键部分之一。</li>
<li>严重影响业务决策。错误的数据分析结论甚至会带来致命影响；有效的数据分析结论带来业务的增益的决策，长期的增益分析对于把握业务方向帮助显著。</li>
<li>需长期思考锻炼提高。实际的业务数据纷繁复杂、变动频率高、业务强相关，故需要具备一定的广度。例如电商成交数据和足球场上胜负关系数据是两个完全不同的过程，二者不互通。</li>
<li><strong>SQL is all you need</strong>。到2019年SQL仍然是最通用、最标准、最普适的数据处理语言，故本文以SQL为例进行展开。</li>
</ul>
<hr>
<h2 id="Core-Idea"><a href="#Core-Idea" class="headerlink" title="Core Idea"></a>Core Idea</h2><ul>
<li>结论导向：永远不做没有目的的数据分析，必须<strong>提前想清楚通过数据要验证什么事实</strong>；具体做法，先假设你预期结论成立，心里想象数据画出来图是什么样子，然后统计下来对比画出来的图和前期假设图是否相似，若相似那么很快就能验证一些效果；若不相似，再考虑当前统计层次是否有问题，能否做更细的拆解或者能否精简一下统计层面；</li>
<li>逻辑自恰：数据是流体，总是呈现起伏不定的规律，我们既要抓住一般规律，同时也要尽可能完美解释细节变化产生原因，即<strong>在给出业务结论时一定要有自洽的逻辑</strong>，对于图中出现的一切现象都要给出非常明确的解释（哪怕解释是片面的、缺乏依据的），为什么上涨，为什么下跌，为什么突然有峰值；</li>
</ul>
<h2 id="Check-amp-Recheck"><a href="#Check-amp-Recheck" class="headerlink" title="Check &amp; Recheck"></a>Check &amp; Recheck</h2><center>Scale >= Empty >= Repeatment >= Outlier</center>

<ul>
<li>Scale: 关注数据规模（量级），不同量级数据切入方式不同（好比菜刀用来切菜/水果刀用于切水果), 海量数据要考虑简化处理<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">COALESCE(expr1, expr2, ...)</span><br><span class="line">CASE value</span><br><span class="line">    WHEN value1 THEN result1</span><br><span class="line">    WHEN value2 THEN result2</span><br><span class="line">    ...</span><br><span class="line">    ELSE result</span><br><span class="line"><span class="keyword">END</span> </span><br><span class="line"><span class="comment">-- 日期处理: datetime类型和字符串的灵活转化; datetime类型时间滚动;</span></span><br><span class="line">ds=TO_CHAR(<span class="keyword">DATEADD</span>(<span class="keyword">TO_DATE</span>(<span class="string">&#x27;$&#123;bizdate&#125;&#x27;</span>, <span class="string">&#x27;yyyymmdd&#x27;</span>), <span class="number">-1</span>, <span class="string">&#x27;dd&#x27;</span>), <span class="string">&#x27;yyyymmdd&#x27;</span>)</span><br><span class="line">SPLIT_PART(<span class="keyword">string</span> <span class="keyword">str</span>, <span class="keyword">string</span> separator, <span class="built_in">bigint</span> <span class="keyword">start</span>[, <span class="built_in">bigint</span> <span class="keyword">end</span>])</span><br><span class="line"><span class="keyword">SUBSTR</span>(<span class="keyword">string</span> <span class="keyword">str</span>, <span class="built_in">bigint</span> start_position[, <span class="built_in">bigint</span> <span class="keyword">length</span>])</span><br><span class="line"><span class="keyword">CONCAT</span>(<span class="keyword">string</span> a, <span class="keyword">string</span> b...)</span><br><span class="line">WM_CONCAT(<span class="keyword">string</span> separator, <span class="keyword">string</span> <span class="keyword">str</span>)</span><br><span class="line"><span class="keyword">INSTR</span>(<span class="keyword">string</span> str1, <span class="keyword">string</span> str2[, <span class="built_in">bigint</span> start_position[, <span class="built_in">bigint</span> nth_appearance]])</span><br><span class="line">ROW_NUMBER() <span class="keyword">OVER</span>(<span class="keyword">partition</span> <span class="keyword">by</span> col1[, col2…] <span class="keyword">order</span> <span class="keyword">by</span> col1 [<span class="keyword">asc</span>|<span class="keyword">desc</span>][, col2[<span class="keyword">asc</span>|<span class="keyword">desc</span>]…])</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h4 id="采用增量统计减少暴力扫描"><a href="#采用增量统计减少暴力扫描" class="headerlink" title="采用增量统计减少暴力扫描"></a>采用增量统计减少暴力扫描</h4><p>例如，如下代码统计19年6月到10月的所有场景点击率；</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    scene</span><br><span class="line">    , <span class="keyword">SUM</span>(pv)/<span class="keyword">SUM</span>(click) <span class="keyword">AS</span> ctr</span><br><span class="line"><span class="keyword">FROM</span> (</span><br><span class="line">    <span class="keyword">SELECT</span></span><br><span class="line">        scene</span><br><span class="line">        , pv</span><br><span class="line">        , click</span><br><span class="line">    <span class="keyword">FROM</span> table_name</span><br><span class="line">    <span class="keyword">WHERE</span> ds&lt;=<span class="number">20191001</span></span><br><span class="line">        <span class="keyword">AND</span> ds&gt;=<span class="number">20191101</span></span><br><span class="line">        <span class="keyword">AND</span> someflag1=<span class="number">1</span></span><br><span class="line">) tmp0</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> scene</span><br></pre></td></tr></table></figure>
<p>乍看上述代码执行无明显问题，但是计算资源紧张时子查询取日志量级太大会跑不完，Job大概率被无情kill；<br>优化方法：将子查询写入一个表，天级增量中间表，代码如下所示</p>
<p>采用CTE模块化统计逻辑</p>
<p>Common Table Expression, CTE</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 人群特征</span></span><br><span class="line"><span class="keyword">WITH</span> s_basic <span class="keyword">AS</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> </span><br><span class="line">        s_id</span><br><span class="line">        , mele_pay_ratio</span><br><span class="line">        , female_pay_ratio</span><br><span class="line">        , purchase_pay_ratio</span><br><span class="line">        , phd_pay_ratio</span><br><span class="line">        , bachelor_pay_ratio</span><br><span class="line">        , master_pay_ratio</span><br><span class="line">        , f1t17_pay_ratio</span><br><span class="line">        , f18t24_pay_ratio</span><br><span class="line">        , f25t29_pay_ratio</span><br><span class="line">    <span class="keyword">FROM</span> table_name_a</span><br><span class="line">    <span class="keyword">WHERE</span> ds=$&#123;bizdate&#125;</span><br><span class="line">),</span><br><span class="line"><span class="comment">-- 场景点击成交uv特征</span></span><br><span class="line">s_clk_pay_uv_info <span class="keyword">AS</span> (</span><br><span class="line">    <span class="keyword">SELECT</span></span><br><span class="line">        s_id</span><br><span class="line">        , clk_uv_1d</span><br><span class="line">        , clk_uv_3d</span><br><span class="line">        , pay_uv_1d</span><br><span class="line">        , pay_uv_3d</span><br><span class="line">    <span class="keyword">FROM</span> table_name_b</span><br><span class="line">    <span class="keyword">WHERE</span> ds=$&#123;bizdate&#125;</span><br><span class="line">),</span><br><span class="line"><span class="comment">-- 场景人群属性特征</span></span><br><span class="line">s_city_info <span class="keyword">AS</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> </span><br><span class="line">        s_id</span><br><span class="line">        , city_l1_ratio</span><br><span class="line">        , city_l2_ratio</span><br><span class="line">        , city_l3_ratio</span><br><span class="line">        , vip_ratio,</span><br><span class="line">        , normal_ratio</span><br><span class="line">    <span class="keyword">FROM</span> table_name_c</span><br><span class="line">    <span class="keyword">WHERE</span> ds=$&#123;bizdate&#125;</span><br><span class="line">)</span><br><span class="line"><span class="keyword">INSERT</span> OVERWRITE <span class="keyword">TABLE</span> table_name_d <span class="keyword">PARTITION</span> (ds=$&#123;bizdate&#125;)</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    s_basic.*</span><br><span class="line">    , s_clk_pay_uv_info.<span class="string">`(s_id)?+.+`</span></span><br><span class="line">    , s_city_info.<span class="string">`(s_id)?+.+`</span></span><br><span class="line">    , s_avg_price_info.<span class="string">`(s_id|ds)?+.+`</span></span><br><span class="line"><span class="keyword">FROM</span> s_basic</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">OUTER</span> <span class="keyword">JOIN</span> s_clk_pay_uv_info</span><br><span class="line"><span class="keyword">ON</span> s_basic.s_id=s_clk_pay_uv_info.s_id</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">OUTER</span> <span class="keyword">JOIN</span> s_city_info</span><br><span class="line"><span class="keyword">ON</span> s_basic.s_id=s_city_info.s_id</span><br></pre></td></tr></table></figure>

<h2 id="Always-Visualising"><a href="#Always-Visualising" class="headerlink" title="Always Visualising"></a>Always Visualising</h2><p>Why Visualising? </p>
<ul>
<li><p>人对数字敏感度极低，远远比不上人对图像敏感度；</p>
</li>
<li><p>在日常分析、汇报、答辩时”一图胜千言”；</p>
</li>
<li><p>可视化方法众多，勿过多关注于形式（工作不是发论文，最快速度出结论最重要），复用脚本跑数据。<br>武器库</p>
</li>
<li><p>直方图：刻画分布，例如考察拼多多、淘宝、京东不同类目商品的成交分布，京东3C数码最多、淘宝服饰最多、拼多多食品最多；</p>
</li>
</ul>
<ul>
<li>折线图：关注指标趋势变化，较优做法是增加辅助文字进行隐含条件解释，如下图所示对比算法圈成交和商业圈成交额的变化，辅助说明他们之间的交集规模；实际应用中灵活就曲线背后的含义或者引申条件加以说明；</li>
</ul>
<p>想要更精确关注数据的分布：拟合概率密度，如图所示少量样本即可拟合出接近于高斯分布这一事实；</p>
<ul>
<li>热图：刻画多变量关系；</li>
</ul>
<h5 id="特征工程可视化"><a href="#特征工程可视化" class="headerlink" title="特征工程可视化"></a>特征工程可视化</h5><p>在数据挖掘竞赛中，为拟合测试集真实的label分布，特征工程原则是”穷举且互斥“；在线上工程中由于性能要求等因素，特征工程原则是”基础且针对“；采用Xmind思维导图进行特征工程组织是更为条理的方式；</p>
<p>地理信息：QGIS is all you need；使用方法：导入csv文件=&gt;叠加图层=&gt;修改颜色</p>
<h2 id="Optimization"><a href="#Optimization" class="headerlink" title="Optimization"></a>Optimization</h2><p>大数据性能优化在日常产出的必备能力；</p>
<h5 id="MapReduce原理"><a href="#MapReduce原理" class="headerlink" title="MapReduce原理"></a>MapReduce原理</h5><p>数据处理过程分成2个阶段：Map（映射）阶段和Reduce（规约）阶段。</p>
<p>Map前，需要将输入数据进行”分片”。</p>
<ul>
<li>分片：将输入数据切分为大小相等的数据块，每一块作为单个Map Worker的输入被处理，以便于多个Map Worker同时工作。</li>
<li>分片完毕后，多个Map Worker同时工作。每个Map Worker在读入各自的数据后，进行计算处理，最终输出给Reduce。</li>
<li>Map Worker在输出数据时，需要为每一条输出数据指定一个Key。这个Key值决定了这条数据将会被发送给哪一个Reduce Worker。Key值和Reduce Worker是多对一的关系，具有相同Key的数据会被发送给同一个Reduce Worker，单个Reduce Worker有可能会接收到多个Key值的数据。</li>
<li>进入Reduce之前，MapReduce框架会对数据按照Key值排序，使得具有相同Key的数据彼此相邻。如果用户指定了”合并操作”(Combiner)，框架会调用Combiner，将具有相同Key的数据进行聚合。Combiner的逻辑可以由用户自定义实现。与经典的MapReduce框架协议不同，在ODPS中，Combiner的输入、输出的参数必须与Reduce保持一致。这部分的处理通常也叫做”洗牌”(Shuffle)。</li>
<li>Reduce阶段。相同的Key的数据会到达同一个Reduce Worker。同一个Reduce Worker会接收来自多个Map Worker的数据。每个Reduce Worker会对Key相同的多个数据进行Reduce操作。最后一个Key的多条数据经过Reduce的作用后，将变成了一个值。</li>
</ul>
<h5 id="Join长尾优化"><a href="#Join长尾优化" class="headerlink" title="Join长尾优化"></a>Join长尾优化</h5><p>问题表现：Join任务上SQL运行时间超长，某个woker上的任务进度一直在99%卡着不动；Join时间过长有很多原因，本质上是数据中参与Join的Key存在存在一定的分布特点（分布不均衡或者长尾）；<br>Mapjoin: 将Join操作提前到Map端执行，避免因为分发Key不均匀导致数据倾斜。但是Mapjoin的使用有限制，必须是Join中的从表比较小才可用。所谓从表，即Left Outer Join中的右表，或者Right Outer Join中的左表。Mapjoin的使用方法非常简单，在代码中select后加上 /*+ mapjoin(a) */ 即可，其中b代表小表(或者是子查询)的别名。如：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    <span class="comment">/*+MAPJOIN(b)*/</span></span><br><span class="line">    a.c2</span><br><span class="line">    , b.c3</span><br><span class="line"><span class="keyword">FROM</span> (</span><br><span class="line">    <span class="keyword">SELECT</span>  </span><br><span class="line">        c1</span><br><span class="line">        , c2</span><br><span class="line">    <span class="keyword">FROM</span> t1</span><br><span class="line">) a</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">OUTER</span> <span class="keyword">JOIN</span> (</span><br><span class="line">    <span class="keyword">SELECT</span>  </span><br><span class="line">        c1</span><br><span class="line">        , c3</span><br><span class="line">    <span class="keyword">FROM</span> t2</span><br><span class="line">) b</span><br><span class="line"><span class="keyword">ON</span> a.c1=b.c1;</span><br></pre></td></tr></table></figure>
<p>调小mapper.split.size<br>作用：设定一个Map的最大数据输入量，通过设置这个变量达到对Map端输入的控制，单位M，默认256M，在[1, Integer.MAX_VALUE]之间调整。set odps.sql.mapper.split.size=256<br>场景：当每个Map Instance处理的数据量比较大，时间比较长，并且没有发生长尾时，可以适当调小这个参数。如果有发生长尾，则结合odps.sql.mapper.merge.limit.size这个参数设置每个Map的输入数量。</p>
<h5 id="Reduce端长尾优化"><a href="#Reduce端长尾优化" class="headerlink" title="Reduce端长尾优化"></a>Reduce端长尾优化</h5><p>问题表现：Reduce端任务99%进度卡着不动，由Multi COUNT(DISTINCT xx字段) 引起；</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    scene</span><br><span class="line">    , <span class="keyword">COUNT</span>(<span class="keyword">DISTINCT</span> pv)       <span class="keyword">AS</span> pv  </span><br><span class="line">    , <span class="keyword">COUNT</span>(<span class="keyword">DISTINCT</span> click_id) <span class="keyword">AS</span> click</span><br><span class="line"><span class="keyword">FROM</span> table_name_a</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> scene</span><br><span class="line">解决方法：将<span class="keyword">Group</span> <span class="keyword">BY</span>的<span class="keyword">Key</span>分散开（增加一个层次的<span class="keyword">Key</span>），以下代码增加了场景的小时统计，最后再累加统计；</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    scene</span><br><span class="line">    , <span class="keyword">SUM</span>(pv)       <span class="keyword">AS</span> pv  </span><br><span class="line">    , <span class="keyword">SUM</span>(click_id) <span class="keyword">AS</span> click</span><br><span class="line"><span class="keyword">FROM</span> (</span><br><span class="line">    <span class="keyword">SELECT</span></span><br><span class="line">        scene</span><br><span class="line">        , hh</span><br><span class="line">        , <span class="keyword">COUNT</span>(<span class="keyword">DISTINCT</span> pv)       <span class="keyword">AS</span> pv  </span><br><span class="line">        , <span class="keyword">COUNT</span>(<span class="keyword">DISTINCT</span> click_id) <span class="keyword">AS</span> click</span><br><span class="line">    <span class="keyword">FROM</span> table_name_a</span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> scene, hh</span><br><span class="line">) tmp0</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> scene;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/12/11/Data%20Analysis%20Tutorial/" data-id="ckfahcyd30002l0dl9x2u1i6q" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Next &amp;raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Programming-Data/">Programming & Data</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Recsys-Ads-Tech/">Recsys & Ads Tech</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BB%8F%E9%AA%8C%E6%80%BB%E7%BB%93/">经验总结</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%A1%8C%E4%B8%9A%E6%80%9D%E8%80%83/">行业思考</a></li></ul>
    </div>
  </div>


  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/09/14/Item-Based%20CF/">Item-Based CF</a>
          </li>
        
          <li>
            <a href="/2020/06/05/Why%20Alibaba%20%E4%B8%BA%E4%BB%80%E4%B9%88%E5%8E%86%E5%8F%B2%E9%80%89%E6%8B%A9%E4%BA%86%E9%98%BF%E9%87%8C%E5%B7%B4%E5%B7%B4/">Why Alibaba 为什么历史选择了阿里巴巴</a>
          </li>
        
          <li>
            <a href="/2020/04/05/Git%E4%BD%BF%E7%94%A8/">Git使用</a>
          </li>
        
          <li>
            <a href="/2020/04/04/Faiss/">Faiss</a>
          </li>
        
          <li>
            <a href="/2020/03/22/%E7%8B%BC%E4%BA%BA%E6%9D%80%E5%A6%82%E4%BD%95%E8%87%B4%E8%83%9C/">狼人杀如何致胜</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 Gold and Rabbit<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>